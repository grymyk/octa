(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{348:function(e,t,o){"use strict";o.r(t),o.d(t,"FreePreviewManagerClass",(function(){return E})),o.d(t,"FreePreviewManager",(function(){return _}));var i,r=o(357),n=o(360),a=o(3),s=o(6),l=o(4),c=o(57),d=o(0),h=o(363),u=o(75),p=o(17),f=o(129),m=o(76),g=o(555),v=o(58),w=o(460),k=o(81),b=o(132),y=o(7),P=o(25),M=o(178),C=$(window),N=$(document);!function(e){e[e.SignIn=0]="SignIn",e[e.Start=1]="Start",e[e.Expired=2]="Expired"}(i||(i={}));var E=function(){function e(){var e=this;this.previouslyVisibleParagraphs=[],this.hasQueuedUnlocks=!1,this.isPerformingUnlocking=!1,this.handleScrollStop=this.handleScrollStop.bind(this),this.handleModalClose=this.handleModalClose.bind(this),N.on("anonymousFreePreviewStartRequested freePreviewRequested",(function(){return e.startFreePreviewMode()}))}return e.prototype.initialize=function(e,t){var o=this;e&&t&&(this.book!=e||this.bookElement!=t)&&(p.a.lastFreePreviewStartedBookShortName&&p.a.lastFreePreviewStartedBookShortName!=e.shortName&&(p.a.setFreePreviewActive(!1),p.a.lastFreePreviewStartedBookShortName=""),t.isOpen||p.a.isUnlockingWholeContentThroughPointingLink||!s.a.hasScrambledParagraphs()||(this.book=e,this.bookElement=t,Promise.all([P.a.getFreePreviewStatus(this.book.shortName),y.a.isLoggedIn()]).then((function(e){var t=e[0];e[1];null!=o.book&&null!=o.bookElement&&(o.book.remainingPreviewDuration=t.remainingDuration,o.book.previewDuration=t.previewDuration,o.createLockedDocumentFragment(),v.a.isFreePreviewAtBeginningAndNotStarted(o.book)?w.a.renderFreePreviewMessaging():v.a.isFreePreviewAvailableAndContinuing(o.book)?o.startFreePreviewMode():v.a.hasFreePreviewExpired(o.book)&&!y.a.isCurrentlyLoggedIn()?w.a.renderFreePreviewMessaging():v.a.isFreePreviewAvailable(o.book)&&w.a.renderFreePreviewMessaging())}))))},e.prototype.clean=function(){C.off("scroll scrollstop",this.handleScrollStop),p.a.isFreePreviewActive()&&(this.finishFreePreviewMode(),this.sendFreePreviewPausedMessage(),this.isPerformingUnlocking=!1),clearInterval(this.freeTimeTrackerId),M.a.destroyFreePreviewActivityTracker(),$(document.body).removeClass("free-preview-mode"),this.lockedDocumentFragment=null,this.book=null,this.bookElement=null,this.previouslyVisibleParagraphs=null,this.hasQueuedUnlocks=!1},e.prototype.createLockedDocumentFragment=function(){this.lockedDocumentFragment=document.createDocumentFragment();var e=document.createElement("div");e.innerHTML=this.bookElement.content,this.lockedDocumentFragment.appendChild(e)},e.prototype.handleScrollStop=function(){var e=this,t=s.a.getVisibleParagraphs(),o=l.a.arrayDifference(t,this.previouslyVisibleParagraphs),i=l.a.arrayDifference(this.previouslyVisibleParagraphs,t);if(this.isPerformingUnlocking)return this.hasQueuedUnlocks=!0,void(0==l.a.arrayIntersection(t,this.previouslyVisibleParagraphs).length&&c.a.showTemporaryNotification("please wait for unlocking"));this.unlockElements(o),a.a.setTimeout((function(){return e.lockElements(i)}),5),this.previouslyVisibleParagraphs=t},e.prototype.trackFreeTime=function(){var e=this;clearInterval(this.freeTimeTrackerId),this.freeTimeTrackerId=setInterval((function(){if(e.book.previewDuration+=.2,e.book.remainingPreviewDuration-=.2,e.book.remainingPreviewDuration<=1)return e.finishFreePreviewMode(),p.a.lastFreePreviewStartedBookShortName="",void N.trigger("freePreviewModeExpired");e.book.remainingPreviewDuration<=60&&e.book.remainingPreviewDuration>=58&&c.a.showTemporaryNotification("one more min of free preview <br> to go for today"),e.book.remainingPreviewDuration<=152&&e.book.remainingPreviewDuration>=150&&e.triggerIsHalfWayThroughFreePreview()}),200)},e.prototype.startFreePreviewMode=function(){var e=this;p.a.isFreePreviewActive()||null!=this.lockedDocumentFragment&&(N.trigger("freePreviewModeActivated",this.book.isOpen),$(document.body).addClass("free-preview-mode"),p.a.setFreePreviewActive(!0),p.a.lastFreePreviewStartedBookShortName=this.book.shortName,this.sendFreePreviewStartedMessage().then((function(t){t.success&&(C.on("scrollstop",e.handleScrollStop),e.unlockElements(s.a.getVisibleParagraphs()),e.trackFreeTime(),M.a.initalizeFreePreviewActivityTracker((function(){e.pauseFreePreviewMode()}),(function(){M.a.destroyFreePreviewActivityTracker(),e.startFreePreviewMode(),e.handleScrollStop()})))})))},e.prototype.pauseFreePreviewMode=function(){this.sendFreePreviewPausedMessage(),this.lockElements(s.a.getVisibleParagraphs()),this.lockElements(this.previouslyVisibleParagraphs),this.previouslyVisibleParagraphs=null,clearInterval(this.freeTimeTrackerId)},e.prototype.finishFreePreviewMode=function(){var e=this;C.off("scroll scrollstop",this.handleScrollStop),c.a.hideNotification();var t=s.a.getVisibleParagraphs();this.lockElements(t),this.lockElements(this.previouslyVisibleParagraphs),clearInterval(this.freeTimeTrackerId),M.a.destroyFreePreviewActivityTracker(),this.book.remainingPreviewDuration<=1&&u.a.isDotd(this.book).then((function(t){e.renderFreePreviewMessage(!0,i.Expired,t)})).catch((function(t){return e.renderFreePreviewMessage(!0,i.Expired)})),p.a.setFreePreviewActive(!1),$(document.body).removeClass("free-preview-mode"),N.trigger("freePreviewModeDeactivated")},e.prototype.unlockElements=function(e){var t=this;if(null!=e&&0!=e.length){c.a.showTemporaryNotification("unlocking ...");var o=e.filter((function(e){return e.classList.contains("scrambled")})),i=$(o);0!=o.length&&(this.isPerformingUnlocking||(this.isPerformingUnlocking=!0,m.a.unlockFragments(this.book,this.bookElement,f.a.FreePreview,"",o.map((function(e){return $(e)})),"",0,{previewDuration:Math.max(this.book.previewDuration,.1),timezone:l.a.getCurrentTimezone()}).then((function(e){e&&e.previewDuration&&t.book&&e.previewDuration>t.book.previewDuration&&(t.book.previewDuration=e.previewDuration,t.book.remainingPreviewDuration=e.remainingPreviewDuration),t.isPerformingUnlocking=!1,i.addClass("temp-unscrambled"),t.hasQueuedUnlocks?(t.handleScrollStop(),t.hasQueuedUnlocks=!1):c.a.hideNotification()})).catch((function(e){e&&!1===e.success&&"Cannot free preview anymore"==e.reason?(null!=t.book&&(t.book.remainingPreviewDuration=0),t.finishFreePreviewMode(),p.a.lastFreePreviewStartedBookShortName="",N.trigger("freePreviewModeExpired")):c.a.showTemporaryNotification("Error when unlocking"),t.isPerformingUnlocking=!1,t.hasQueuedUnlocks&&(t.hasQueuedUnlocks=!1)}))))}},e.prototype.lockElements=function(e){if(null!=e&&0!=e.length&&null!=this.lockedDocumentFragment)for(var t=0,o=e;t<o.length;t++){var i=o[t],r=$(i);if(!r.is(".scrambled")&&r.is(".unscrambled")){var n=this.lockedDocumentFragment.querySelector("[refid='"+r.attr("refid")+"']");null!=n&&(r.html(n.innerHTML),r.removeClass("unscrambled"),r.addClass("scrambled"),r.removeClass("temp-unscrambled"))}}},e.prototype.handleModalClose=function(){this.renderFreePreviewMessage(!1)},e.prototype.renderFreePreviewMessage=function(e,t,o){var a=this;void 0===e&&(e=!0);var s,l="",c="",d="",p="no thanks",f="",m="";switch(t){case i.Expired:l="your free preview has expired for the day",s="add to cart for 20% off today",d="add-to-cart-button free-preview-add-to-cart-button";var v=null!=this.book?this.book.cleanTitle||this.book.title:"this book";y.a.isCurrentlyLoggedIn()?(f="add to wish list &nbsp; <i class='fa fa-heart'/>",m="add-to-wish-list-button",p="",c="Buy "+v+" to continue reading it, use tokens to get whatever part you need, or come back tomorrow for more preview time."):(f="sign in",m="sign-in-button free-preview-sign-in",p="",c="Buy "+v+" to continue reading it or "+(o?"sign in to preview for 24h":"sign in for more preview time"));break;case i.Start:l="start your free preview",d="start-preview-button",c=this.book&&this.book.isOpen?"The text will unlock so you can read this liveBook for 24h":"The text will unlock so you can read each liveBook for a total of a couple of minutes per day.",s="start";break;case i.SignIn:default:l="sign in to unlock the whole book",s="sign in",d="sign-in-button free-preview-sign-in",c="The text will unlock so you can read each liveBook for a total of 5 minutes per day."}n.render(r.createElement(h.b,{isOpen:e,title:l,onClose:this.handleModalClose,onCancelationClicked:this.handleModalClose,onActionClicked:function(){t==i.Expired?a.book&&!a.book.newerEditionId?u.a.requestAddBookToCart(a.book,!1,b.a.getNewUserDiscountCode()):a.book&&a.book.newerEditionId&&u.a.requestAddNewerEditionToCart(a.book.newerEditionId):t==i.Start&&a.startFreePreviewMode(),a.renderFreePreviewMessage(!1)},additionalModalHeaderClass:"time-limited-preview-message-header-container",mainContainerClassName:"time-limited-preview-message-container",actionMessageHTML:s,actionButtonAdditionalClass:d,secondayActionMessageHTML:f,secondaryActionButtonAdditionalClass:m,onSecondaryActionClicked:function(){y.a.isCurrentlyLoggedIn()&&g.a.addCurrentBookToWishList(),a.renderFreePreviewMessage(!1)},isContentVerticalTop:!1,cancelationMessageHTML:p},r.createElement("div",{className:"time-limited-preview-content-container"},r.createElement("em",null,c))),document.getElementById("full-screen-modal"))},e.prototype.triggerIsHalfWayThroughFreePreview=function(){clearTimeout(this.halfwayThrottleTimer),this.halfwayThrottleTimer=a.a.setTimeout((function(){$(document).trigger("halfWayThroughFreePreview")}),2300)},e.prototype.sendFreePreviewStartedMessage=function(){var e=this;return new Promise((function(t,o){k.a.getAbTestVariant().then((function(i){d.a.postToOurBackend(d.a.getAbsoluteUrl("api/userBook/startFreePreview"),(function(o){if(o&&o.previewDuration&&e.book&&o.previewDuration>e.book.previewDuration){var i=o.previewDuration-e.book.previewDuration;e.book.previewDuration=o.previewDuration,e.book.remainingPreviewDuration-=i}t(o)}),(function(e){return o()}),{bookShortName:e.book.shortName,timezone:l.a.getCurrentTimezone()},!0)}))}))},e.prototype.sendFreePreviewPausedMessage=function(){this.book&&this.book.shortName&&d.a.postToOurBackend(d.a.getAbsoluteUrl("api/userBook/pauseFreePreview"),(function(e){}),(function(e){}),{bookShortName:this.book.shortName},!0)},e}(),_=new E},363:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i,r,n=o(357),a=o(390),s=o(358),l=(o(369),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e[e.standard=0]="standard",e[e.dark=1]="dark",e[e.gold=2]="gold",e[e.green=3]="green",e[e.red=4]="red"}(r||(r={}));var c={backgroundColor:"rgba(0, 0, 0, 0.75)",zIndex:1008,top:0,display:"flex",alignItems:"center",justifyContent:"center",position:"fixed"},d={alignItems:"flex-start"},h={backgroundColor:"rgb(255, 255, 255)",display:"fixed",position:"relative",top:"unset",left:"unset",right:"unset",bottom:"unset",border:"unset",borderRadius:"unset",width:"100%",color:"#3C3C3C",overflow:"visible",padding:"20px 40px"},u={maxWidth:"600px",margin:"0 auto",padding:"0"},p={maxHeight:"90vh",overflow:"auto",maxWidth:"85vw"},f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.render=function(){var e=this,t=Object.assign({},h),o=c,i=Object.assign({},p),s=Object.assign({},u);this.props.isContentVerticalTop&&(o=Object.assign({},o,d)),this.props.isPositionStatic&&(o=Object.assign({},o,{position:"static"})),this.props.dontGoFullWidth&&(t=Object.assign({},t,{width:"auto"})),this.props.hasNoPadding&&(t=Object.assign({},t,{padding:"0"})),this.props.noWidthLimitation&&(i=Object.assign({},i,{maxWidth:"auto"}),s=Object.assign({},s,{maxWidth:"auto"})),this.props.theme==r.dark?t=Object.assign({},t,{backgroundColor:"rgb(51, 51,51)"}):this.props.theme==r.gold?t=Object.assign({},t,{backgroundColor:"rgb(254, 203, 47)"}):this.props.theme==r.green?t=Object.assign({},t,{backgroundColor:"rgb(57, 121, 38)"}):this.props.theme==r.red&&(t=Object.assign({},t,{backgroundColor:"rgb(195, 41, 28)"})),this.props.contentTopOffset&&(t=Object.assign({},t,{top:this.props.contentTopOffset})),this.props.initialOverlayTop&&(o.top=this.props.initialOverlayTop,i.maxHeight="calc("+p.maxHeight+" - "+this.props.initialOverlayTop+")");var l={"dark-theme":this.props.theme==r.dark,"gold-theme":this.props.theme==r.gold,"green-theme":this.props.theme==r.green,"red-theme":this.props.theme==r.red};return this.props.parentElement&&this.props.parentElement!=document.body?n.createElement("div",{className:"ReactModal__Overlay",style:o},n.createElement("div",{style:t},this.generateModalContent(l,s,i))):n.createElement(a,{isOpen:this.props.isOpen,appElement:document.body,style:{overlay:o,content:t},parentSelector:function(){return document.body},onRequestClose:function(){null!=e.props.onClose&&(e.props.onClose instanceof Function?e.props.onClose():console.error&&console.error("onClose is not a function",e.props.onClose,e.props.mainContainerClassName))}},this.generateModalContent(l,s,i))},t.prototype.generateModalContent=function(e,t,o){var i=this;return n.createElement(n.Fragment,null,n.createElement("div",{className:s("modal-header",e,this.props.additionalModalHeaderClass)},n.createElement("div",{className:"modal-back-button-container"},this.props.hasBackButton?n.createElement("div",{className:"modal-header-button",onTouchStart:function(e){return i.props.onBack&&i.props.onBack()},onClick:function(e){return i.props.onBack&&i.props.onBack()}},n.createElement("i",{className:"fa fw fa-chevron-left"})):n.createElement("i",{className:"fa fw fa-chevron-left",style:{opacity:0}})),n.createElement("div",{className:"modal-title-container"},this.props.title&&n.createElement("h3",{dangerouslySetInnerHTML:{__html:this.props.title}}),this.props.subtitle&&n.createElement("span",{style:this.props.subtitleStyle},this.props.subtitle)),n.createElement("div",{onTouchStart:function(e){return i.props.onClose&&i.props.onClose()},onClick:function(e){return i.props.onClose&&i.props.onClose()},className:s("modal-close-button-container",{"no-padding":this.props.hasNoPadding})},n.createElement("div",{className:"modal-header-button"},n.createElement("i",{className:"fa fw fa-times"})))),n.createElement("div",{className:s(this.props.mainContainerClassName,e),style:t},n.createElement("div",{style:o,className:"modal-content-container"},this.props.children,n.createElement("div",null,this.props.actionMessageHTML&&n.createElement("span",{className:s("tokens-button action-button",this.props.actionButtonAdditionalClass),onClick:this.props.onActionClicked,dangerouslySetInnerHTML:{__html:this.props.actionMessageHTML}}),this.props.secondayActionMessageHTML&&n.createElement("span",{className:s("tokens-button action-button",this.props.secondaryActionButtonAdditionalClass),onClick:this.props.onSecondaryActionClicked,dangerouslySetInnerHTML:{__html:this.props.secondayActionMessageHTML}})),this.props.cancelationMessageHTML&&n.createElement("span",{className:"tokens-button cancel-button",onClick:this.props.onCancelationClicked,dangerouslySetInnerHTML:{__html:this.props.cancelationMessageHTML}}))))},t}(n.Component);t.b=f},369:function(e,t,o){var i=o(370);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};o(98)(i,r);i.locals&&(e.exports=i.locals)},370:function(e,t,o){(e.exports=o(97)(!1)).push([e.i,".ReactModal__Overlay{animation:fade-in-black-background 0.1s ease-in-out;font-family:'Lato';position:relative;text-align:left}.ReactModal__Overlay .dark-theme .modal-title-container{color:#fecb2f}.ReactModal__Overlay .dark-theme p{color:white}.ReactModal__Overlay .green-theme{color:white}.ReactModal__Overlay .green-theme .modal-header-button{color:white}.ReactModal__Overlay .green-theme h3,.ReactModal__Overlay .green-theme em,.ReactModal__Overlay .green-theme p{color:white}.ReactModal__Overlay .red-theme{color:white}.ReactModal__Overlay .red-theme .modal-header-button{color:white}.ReactModal__Overlay .red-theme h3,.ReactModal__Overlay .red-theme em,.ReactModal__Overlay .red-theme p{color:white}.ReactModal__Overlay .gold-theme .modal-header-button{color:#c69501}.ReactModal__Overlay .gold-theme h3{font-weight:bold}.ReactModal__Overlay .gold-theme .modal-content-container{margin-top:-1em;overscroll-behavior:none;-ms-scroll-chaining:none}.ReactModal__Overlay .modal-header{display:flex;align-items:center;justify-content:space-between;font-weight:300;line-height:1}.ReactModal__Overlay .modal-header-button{font-size:1em;cursor:pointer;user-select:none;color:#9a9a9a}.ReactModal__Overlay .modal-back-button-container{position:absolute;top:35px;left:20px}.ReactModal__Overlay .modal-close-button-container{position:absolute;top:35px;right:20px;z-index:10;padding:1em;margin:-1em;cursor:pointer}.ReactModal__Overlay .modal-close-button-container.no-padding{top:25px}@media screen and (max-width: 450px){.ReactModal__Overlay .modal-close-button-container.no-padding{top:15px}}.ReactModal__Overlay .modal-title-container{max-width:600px;margin:0 auto}.ReactModal__Overlay h3{font-size:2em;font-weight:300;display:inline-block;margin:0 0.5em 20px 0;color:inherit}.ReactModal__Overlay .modal-title-container{flex:1 auto}.ReactModal__Overlay .cancel-button{float:right}.ReactModal__Overlay .tokens-button{background-color:gray}.ReactModal__Overlay .tokens-button:hover:not(.disabled){background-color:#9a9a9a}.ReactModal__Overlay .tokens-button:active:not(.disabled){background-color:#8d8d8d}.ReactModal__Overlay .tokens-button.action-button{color:white;background-color:#3C67A2}.ReactModal__Overlay .tokens-button.action-button:hover:not(.disabled){background-color:#5280bf}.ReactModal__Overlay .tokens-button.action-button:active:not(.disabled){background-color:#4373b5}@keyframes fade-in-black-background{0%{background-color:rgba(0,0,0,0)}100%{background-color:rgba(0,0,0,0.75)}}\n",""])},460:function(e,t,o){"use strict";o.d(t,"a",(function(){return h}));var i=o(0),r=o(75),n=(o(556),o(29)),a=o(3),s=o(17),l=o(58),c=o(6),d=o(7),h=new(function(){function e(){var e=this;this.$headerNotificationContainer=$("#header-notification-container"),this.$headerNotificationContainer.on("click",".free-ebook-sign-in",(function(){n.a.requestOpenModal("signin","sign in to read this free ebook","free-ebook-sign-in")})),this.$headerNotificationContainer.on("click",".free-preview-sign-in",(function(e){$(e.target).is(".add-dotd-book-to-cart")||n.a.requestOpenModal("signin","sign in to unlock this book","free-preview-sign-in")})),this.$headerNotificationContainer.on("click",".fa-close",(function(){e.hideHeaderNotifier(),$(document).trigger("headerNotifierHidden")})),this.$headerNotificationContainer.on("click",".add-dotd-book-to-cart",(function(){null!=e.dotdPromoInfo&&r.a.requestAddBookToCartByBookShortName(e.book.shortName,e.dotdPromoInfo.discountCode),e.dotdPromoInfo=null,e.hideHeaderNotifier()})),this.$headerNotificationContainer.on("click",".free-preview-start",(function(e){$(e.target).is(".newer-version-link")?document.location=e.target.href:$(document).trigger("freePreviewRequested")})),$(document).on("freePreviewModeActivated freePreviewModeDeactivated",(function(){a.a.setTimeout((function(){e.renderFreePreviewMessaging()}),16)})),$(document).on("freePreviewModeExpired",(function(){d.a.isCurrentlyLoggedIn()&&e.hideHeaderNotifier()}))}return e.prototype.setPromotion=function(e){this.dotdPromoInfo=e,this.initialize(this.book,this.bookElement)},e.prototype.initialize=function(e,t){var o=this;if(this.book=e,this.bookElement=t,null!=e||null!=t){if(e.latestMeapVersion!=t.meapVersion&&0!=e.latestMeapVersion&&null!=t.meapVersion)return this.$headerNotificationContainer.html('<a href="'+i.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)+"\"> Newer version available! <span class='action-label'>Access the latest version</span></a>"),void this.showHeaderNotifier();r.a.getNewestEditionProduct(e).then((function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&(e.newerEditionId=t.newestEditionProduct.id,o.$headerNotificationContainer.html('<a href="'+i.a.getBookElementUrl(t.newestEditionProduct.slug,"")+"\"> Newer edition available! <span class='action-label'>Access the latest version</span></a>"),o.showHeaderNotifier())})),this.renderPromoMessage()}else this.renderPromoMessage()},e.prototype.clean=function(){this.hideHeaderNotifier(),this.book=null,this.bookElement=null},e.prototype.renderPromoMessage=function(){if(null!=this.dotdPromoInfo){var e=null!=this.book&&this.book.shortName==this.dotdPromoInfo.productExternalId;if(null==this.book||e){if(null!=this.book&&this.book.userOwnsBook)return;this.showHeaderNotifier(),this.$headerNotificationContainer.html("\n                <div class='promo-header'>\n                    <a class=\"single-line "+(e?"add-dotd-book-to-cart":"")+'" href="'+(e?"javascript:void(0)":this.dotdPromoInfo.productLink)+'" data-product-external-id='+this.dotdPromoInfo.productExternalId+">"+(e?this.dotdPromoInfo.shortMessage:this.dotdPromoInfo.headerMessage)+'</a>\n                    <i class="fa fa-close close-promo-button" data-product-external-id="'+this.dotdPromoInfo.productExternalId+'"/>\n                </div>\n            ')}}},e.prototype.renderFreePreviewMessaging=function(){var e=this;if((null==this.bookElement||!this.bookElement.isOpen)&&c.a.hasScrambledParagraphs()){var t=this.getHeadingAndDescription(this.book,d.a.isCurrentlyLoggedIn());null!=t?(this.showHeaderNotifier(),this.$headerNotificationContainer.html('<div class="free-preview-notifier '+(t.additionalClass||"")+'">\n                <span class="free-preview-heading-wrapper">'+t.heading+"</span>\n                "+(t.description?'<i class="fa fa-question-circle dont-propagate-click" data-tooltip aria-haspopup="true" data-options="disable_for_touch:true;" title="'+t.description+'" aria-hidden="true"></i>':"")+"\n                <a class=\"newer-version-link dont-propagate-click hidden\" style='display: inline;' href=\"\">(access the <span style='text-decoration: underline'>latest</span> version)</a>\n             </div>"),"free-preview-starting"==t.additionalClass&&this.countDownToAutoStartFreePreview(),this.$headerNotificationContainer.foundation("tooltip"),"free-preview-start"!=t.additionalClass&&"free-preview-running"!=t.additionalClass&&"free-preview-sign-in"!=t.additionalClass||(this.book.latestMeapVersion!=this.bookElement.meapVersion?this.updateNewerVersionLink(i.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)):r.a.getNewestEditionProduct(this.book).then((function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&e.updateNewerVersionLink(i.a.getBookElementUrl(t.newestEditionProduct.slug,""))})))):this.hideHeaderNotifier()}},e.prototype.updateNewerVersionLink=function(e){this.$headerNotificationContainer.find(".newer-version-link").attr("href",e).removeClass("hidden")},e.prototype.countDownToAutoStartFreePreview=function(){var e=this;0!=this.$headerNotificationContainer.find(".free-preview-auto-start-countdown").length&&a.a.setTimeout((function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").addClass("activate-1"),a.a.setTimeout((function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-1").addClass("activate-2"),a.a.setTimeout((function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-2").addClass("activate-3"),a.a.setTimeout((function(){$(document).trigger("anonymousFreePreviewStartRequested")}),1e3)}),1e3)}),1e3)}),1)},e.prototype.getHeadingAndDescription=function(e,t){return e.isFreeEbook?t?null:{heading:"<span class='action-label'>sign in</span> to access this free eBook",description:"This eBook is free after you log in",additionalClass:"free-ebook-sign-in"}:s.a.isFreePreviewActive()?{heading:this.hasAdditionalPriceMessage()?"in free preview"+this.getAdditionalPriceMessage():"freely previewing "+this.book.cleanTitle,description:"",additionalClass:"free-preview-running"}:l.a.isFreePreviewAtBeginningAndNotStarted(e)||l.a.isFreePreviewAvailable(e)?t?e.isOpen?{heading:"<span class='action-label'>start</span> your 24h free preview",description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-start"}:{heading:"<span class='action-label'>start</span> your free preview",description:"The text will unlock so you can read each liveBook for a couple of minutes per day.",additionalClass:"free-preview-start"}:{heading:"starting free preview in <span class='free-preview-auto-start-countdown'><div class='free-preview-count-down-wrapper'><div class='free-preview-count-down-3'>3</div><div class='free-preview-count-down-2'>2</div><div class='free-preview-count-down-1'>1</div><div class='free-preview-count-down-0'>0</div></div></span>",additionalClass:"free-preview-starting",description:""}:l.a.hasFreePreviewExpired(e)&&!t?e.isOpen?{heading:"<span class='action-label'>sign in</span> to unlock the whole book for 24h"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-sign-in"}:{heading:"<span class='action-label'>sign in</span> to unlock the whole book"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day.",additionalClass:"free-preview-sign-in"}:void 0},e.prototype.getAdditionalPriceMessage=function(){return this.hasAdditionalPriceMessage()?' <span class="action-label add-dotd-book-to-cart" data-product-external-id='+this.dotdPromoInfo.productExternalId+">(get the book for "+this.dotdPromoInfo.priceMessage+")</span>":""},e.prototype.hasAdditionalPriceMessage=function(){return null!=this.dotdPromoInfo&&null!=this.book&&this.dotdPromoInfo.productExternalId==this.book.shortName},e.prototype.hideHeaderNotifier=function(){this.$headerNotificationContainer.addClass("hidden"),$(document).trigger("headerNotifierHidden")},e.prototype.showHeaderNotifier=function(){this.$headerNotificationContainer.removeClass("hidden"),$(document).trigger("headerNotifierShown")},e}())},555:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o(5),r=new(function(){function e(){this.shouldWishListABeShown=!0}return e.prototype.initialize=function(e){this.getWishListManagerSource().then((function(t){return t.WishListManager.initalize(e)}))},e.prototype.clean=function(){this.getWishListManagerSource().then((function(e){return e.WishListManager.clean()}))},e.prototype.addCurrentBookToWishList=function(){this.getWishListManagerSource().then((function(e){return e.WishListManager.addCurrentBookToWishList()}))},e.prototype.getWishListManagerSource=function(){return this.wishListManagerSourcePromise||(this.wishListManagerSourcePromise=i.a.importWebpackModuleWithRetry(this.constructWishListManagerSourcePromise)),this.wishListManagerSourcePromise},e.prototype.constructWishListManagerSourcePromise=function(){return o.e(54).then(o.bind(null,767))},e}())},556:function(e,t,o){var i=o(557);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};o(98)(i,r);i.locals&&(e.exports=i.locals)},557:function(e,t,o){(e.exports=o(97)(!1)).push([e.i,"#header-notification-container{background-color:#5facbe;line-height:1.8;color:white;text-align:center;margin:0 auto;user-select:none;-webkit-user-select:none}@media screen and (max-width: 689px){#header-notification-container{font-size:0.75rem}}#header-notification-container a{color:white;font-weight:350;display:block;width:100%;font-size:13px;padding:2px}#header-notification-container .action-label{text-decoration:underline;display:inline-block}#header-notification-container .free-preview-notifier{cursor:pointer;font-weight:300;user-select:none;-webkit-user-select:none;background-color:#ffcc00;color:#3c3c3c;transition:background-color 0.5s ease-in;white-space:nowrap;padding:0 1em;overflow:hidden;text-overflow:ellipsis}#header-notification-container .free-preview-notifier.free-preview-starting .free-preview-heading-wrapper{display:flex;justify-content:center}#header-notification-container .free-preview-notifier.free-preview-running{background-color:#5cb85c;color:white;cursor:initial}#header-notification-container .free-preview-notifier spanÂ {font-size:90%;font-weight:300}#header-notification-container .free-preview-notifier i{display:inline-block;margin-left:0.25em}#header-notification-container .free-preview-notifier .free-preview-auto-start-countdown{position:relative;overflow:hidden;display:inline-block;height:1.4em;margin-left:0.3em;font-weight:bold}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper{transition:transform 1s ease-in-out}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-1{transform:translateY(-25%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-2{transform:translateY(-50%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-3{transform:translateY(-75%)}#header-notification-container .free-preview-notifier .free-preview-count-down-3{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-2{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-1{display:block}.promo-header{padding:0 0.5em;display:flex;align-items:center}.promo-header a{font-weight:normal}.promo-header a:hover{text-decoration:underline}.promo-header .fa{margin:0 0.5em;cursor:pointer}.add-dotd-book-to-cart{cursor:pointer}\n",""])}}]);
//# sourceMappingURL=freePreviewManager.chunk.js.map?b520e62ab6eb57a289de