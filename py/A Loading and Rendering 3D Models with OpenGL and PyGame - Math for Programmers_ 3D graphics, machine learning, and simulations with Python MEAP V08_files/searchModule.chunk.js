(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{351:function(e,t,n){"use strict";n.r(t),n.d(t,"SearchMenu",(function(){return k}));var r,a=n(357),o=n(360),i=n(3),s=n(9),l=n(1280),c=n(28),h=n(386),u=n(722),d=n(723),g=n(416),p=n(0),f=n(128),m=n(415),v=(n(174),$(document)),S=$(document.body);r=c.a.prod;var k=new(function(){function e(){var e=this;this.searchFallback={},this.isInitialAutocompleteTriggered=!1,this.$searchModal=$("#search-modal"),0==this.$searchModal.length&&($(document.body).append('<div id="search-modal" class="search-modal" style="display:none">\n                                        <div class="search-react-container"></div>\n                                    </div>'),this.$searchModal=$("#search-modal")),i.a.onEventWithCooldown($("#top-bar-container .search-menu-button"),"click touchstart",(function(){return e.showSearch()})),i.a.onEventWithCooldown($("#search-modal > .close-button"),"click touchstart",(function(){return e.hideSearch()})),v.on("slideMenuCloseRequested",(function(){return e.hideSearch()})),window.addEventListener("hashchange",(function(){return e.hideSearch()})),window.addEventListener("popstate",(function(){return e.hideSearch()})),this.searchStore=new h.c(c.b.livebook,r,new u.a(new d.a(c.b.livebook,r,null)),(function(t,n){return e.handleSuggestionOrLinkSelected(t,n)}),(function(){return e.hideSearch()}),(function(e,t,n){v.trigger("searchMade",e+"-;-"+(t?"library":n))})),this.searchStore.onPropertyChanged((function(t,n){return e.handleStoreStateChanged(t,n)})),this.searchStore.onSuggestionSelected=function(e){e instanceof g.b?v.trigger("searchSuggestion",["product",e.slug]):e instanceof g.a?v.trigger("searchSuggestion",["concept",e.title]):v.trigger("searchSuggestion",["text",e])},setTimeout((function(){o.render(a.createElement(l.a,{store:e.searchStore}),e.$searchModal.children(".search-react-container")[0])}),10),v.on("searchHideRequested",(function(){return e.hideSearch()})),v.on("searchHighlightRequested",(function(t,n,r){e.highlightCurrentResults(n,r)}))}return e.prototype.initialize=function(e,t){this.book=e,this.bookElement=t,null!=this.book?this.searchStore.setIsInLibraryAndProduct(null!=this.searchStore.state.items&&this.searchStore.state.items.length>0,this.book.shortName):this.searchStore.clearSearchAndProduct()},e.prototype.handleStoreStateChanged=function(e,t){var n=this;(null==e.items||0==e.items.length)&&null!=t.items&&t.items.length>0?i.a.setTimeout((function(){n.addSearchButtonGlow(),null!=n.book&&null!=n.bookElement&&n.highlightCurrentResults(n.book,n.bookElement)}),50):null!=e.items&&e.items.length>0&&(null==t.items||0==t.items.length)&&this.removeSearchButtonGlow()},e.prototype.showSearch=function(){var e=this;S.addClass("modal-open"),v.trigger("searchOpen"),this.$searchModal.css("display","block"),this.$searchModal.children(".close-button").css("display","block"),this.searchStore.isSearchMenuHidden=!1,i.a.setTimeout((function(){e.$searchModal.addClass("shown"),e.searchStore.triggerLayoutRecalc(),e.searchStore.state.isShowingResults||e.$searchModal.find(".search-input").focus(),e.isInitialAutocompleteTriggered||(e.searchStore.initialAutocompleteProducts(),e.isInitialAutocompleteTriggered=!0)}),10)},e.prototype.hideSearch=function(){var e=this;this.$searchModal.removeClass("shown"),S.removeClass("modal-open"),this.searchStore.isSearchMenuHidden=!0,setTimeout((function(){e.$searchModal.css("display","none")}),200)},e.prototype.handleSuggestionOrLinkSelected=function(e,t){if(e instanceof g.b)if(e.isLivebook){var n=p.a.getBookUrl(e.slug);page(n),this.hideSearch()}else e.isLivevideo?f.a.openLinkInNewTab(p.a.getLiveVideoUrl("course/"+e.externalId+"/"+e.slug)):e.link&&e.link.startsWith("http")?f.a.openLinkInNewTab(e.link):f.a.openLinkInNewTab(p.a.getMarketplaceProductUrl(e.slug,!1));else if(e instanceof g.a){if((a=t||e.link)&&-1!=a.indexOf("/book/")){var r=this.expandLinkWithSearchParameter(e,a);f.a.isLivebookLink(r)&&this.hideSearch(),f.a.openLink(r)}}else if("string"==typeof e||""!=t){var a;(a=t||e)&&(f.a.isLivebookLink(a)&&this.hideSearch(),f.a.openLink(a))}},e.prototype.expandLinkWithSearchParameter=function(e,t){return t},e.prototype.addSearchButtonGlow=function(){},e.prototype.removeSearchButtonGlow=function(){},e.prototype.highlightCurrentResults=function(e,t){var n=this.searchStore.state.items,r=this.searchStore.state.query;null!=n&&0!=n.length&&r&&this.markCurrentBookElementResults(e,t,n.find((function(t){return t.productTitle===e.title})))},e.prototype.removeSearchHighlights=function(){var e=$(".contains-search-result");e.removeClass("contains-search-result"),e.each((function(e,t){s.a.unwrapIntoParent($(t).find(".search-result"))}))},e.prototype.markCurrentBookElementResults=function(e,t,n){if(e&&t&&n){$(".contains-search-result").removeClass("contains-search-result");var r=$("#book-markup-container .search-result");if(r.removeClass("search-result"),r.each((function(e,t){var n=$(t),r=t.parentElement;n.replaceWith(n.text()),r.normalize()})),e){e.title;for(var a=[],o={},i=0,s=n.results;i<s.length;i++){var l=s[i];if(l.elementTitle===t.title)a.push(l),(c=this.extractIdFromLink(l.link))&&(o[c]=$("<div>"+l.text+"</div>").find(".search-result").eq(0).text())}try{for(var c in o)if(o[c]){var h=$(c);0===h.length&&(h=$("#"+c));var u=h.is(".readable-text")?h:h.closest(".readable-text");u[0]&&m.a.highlight(u[0],o[c],"search-result")}}catch(e){console.log("Error when markCurrentBookElementResults: ",e)}}}},e.prototype.extractIdFromLink=function(e){if(!e||!e.trim())return"";var t=e.indexOf("search-");return-1==t?"":e.substring(t+"search-".length)},e.prototype.getAdditionalSearchWebProviderParams=function(){return null},e}())},415:function(e,t,n){"use strict";var r=n(9),a=function(){function e(){}return e.prototype.highlight=function(e,t,n,a,o){if(void 0===a&&(a=""),void 0===o&&(o=""),e){var i=$(e);i.is(".fragment-played")&&(a="");var s=r.a.getAllDescendantTextNodes(e),l=r.a.createTextNodeTextRanges(s),c=this.getStartIndex(l.value,t,o),h=c+t.length;if(-1!==c||(h=(c=l.value.indexOf(t.replace("<","&lt;").replace(">","&gt;")))+t.length,-1!=c)){var u=r.a.splitRanges(l,c,h);if(this.markVisibleParentNodeElements(e,u.followingRanges,a),this.liftWordsInMatchingRanges(u.matchingRanges,c,h,n,a),this.liftWordsInFollowingRanges(u.followingRanges,a),""!=a.trim()){var d="."+a.trim().replace(/\s+/,".");i.find(d).each((function(e,t){var n=$(t.nextSibling);n.is("img")&&n.addClass(a)}))}}}},e.prototype.liftWordsInMatchingRanges=function(e,t,n,a,o){for(var i=0,s=e.length;i<s;i++){var l=e[i],c=l.textNode.nodeValue;if(0==i){var h=t-l.start,u=n-l.start,d=c.substring(0,h),g=c.substring(h,u),p=c.substring(u,l.end);$(l.textNode).replaceWith(d+r.a.wrapToHtmlElement("span",{class:a},g)+(""!=p&&""!=o?r.a.wrapToHtmlElement("span",{class:o},p):p))}else if(i==s-1){var f=n-l.start;g=c.substring(0,f),p=c.substring(f,c.length);$(l.textNode).replaceWith(r.a.wrapToHtmlElement("span",{class:a},g)+(""!=p&&""!=o?r.a.wrapToHtmlElement("span",{class:o},p):p))}else $(l.textNode).replaceWith(r.a.wrapToHtmlElement("span",{class:a},c))}},e.prototype.liftWordsInFollowingRanges=function(e,t){if(t)for(var n=0;n<e.length;n++){var a=e[n];a.textNode.nodeValue&&a.textNode.nodeValue.trim()&&$(a.textNode).replaceWith(r.a.wrapToHtmlElement("span",{class:t},a.textNode.nodeValue))}},e.prototype.markVisibleParentNodeElements=function(e,t,n){if(e&&t&&0!=t.length&&n)for(var r=0;r<t.length;r++){var a=t[r].textNode;"KBD"==a.parentNode.nodeName&&$(a.parentNode).addClass(n)}},e.prototype.getAllIndexesOf=function(e,t){for(var n,r=0,a=[];(n=e.indexOf(t,r))>-1;)a.push(n),r=n+t.length;return a},e.prototype.getStartIndex=function(e,t,n){var r=this.getAllIndexesOf(e,t);if(0==r.length)return-1;if(1==r.length)return r[0];if(!n)return r[0];var a=e.indexOf(n);if(-1==a)return r[0];a+=n.length;for(var o=0;o<r.length;o++)if(r[o]>=a)return r[o];return r[0]},e}();t.a=new a}}]);
//# sourceMappingURL=searchModule.chunk.js.map?3aed2ccd39ae596e26bf