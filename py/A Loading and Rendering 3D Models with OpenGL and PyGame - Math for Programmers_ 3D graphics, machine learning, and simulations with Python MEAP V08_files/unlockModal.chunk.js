(window.webpackJsonp=window.webpackJsonp||[]).push([[37,26,36,38],{344:function(e,t,n){"use strict";n.r(t),n.d(t,"UnlockText",(function(){return m}));var o=n(15),r=n(3),i=n(16),a=n(1),c=n(4),s=n(17),l=n(129),u=n(76),d=n(25),f=$(document),p=a.b.isTouchDevice(),m=new(function(){function e(){var e=this;this.handleUnlockSuccess=this.handleUnlockSuccess.bind(this),this.handleUnlockHeadingClick=this.handleUnlockHeadingClick.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleHeadingMouseEnter=this.handleHeadingMouseEnter.bind(this),f.on("freePreviewModeActivated",(function(){e.hideHeadingLocks()})),f.on("freePreviewModeDeactivated",(function(){e.showHeadingLocks()})),f.on("pointingLinkOpened",(function(t,n,o){o&&e.hideHeadingLocks()}))}return e.prototype.initialize=function(e,t){var n=this;null!=t&&t.isOpen||null==t.bookElementPriceInfo||e&&(s.a.isUnlockingWholeContentThroughPointingLink||(this.book=e,this.bookElement=t,$(document.body).addClass("unlock-supported"),this.$headings=o.a.getHeadings(),f.on("unlockSuccess",this.handleUnlockSuccess),this.book&&r.a.setTimeout((function(){n.$headings.each((function(e,t){var r=$(t),i=o.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,r,n.$headings);i>0&&0==r.find(".scrambled-notifier").length&&r.append(n.generateScrambledParagraphNotifierHTML(i,!0,r.text().trim()))})),s.a.isFreePreviewActive()&&n.hideHeadingLocks(),p||n.$headings.on("mouseenter",n.handleHeadingMouseEnter)}),10),this.book.isParagraphByParagraphUnlockDisabled||(f.on("mouseenter",".readable-text.scrambled",this.handleMouseEnter),f.on("mouseleave",".readable-text.scrambled",this.handleMouseLeave),$(".readable-text.scrambled").on("click",this.handleScrambledTextClick)),f.on("click",".scrambled-notifier",this.handleScrambledTextClick)))},e.prototype.clean=function(){this.$headings=null,f.off("unlockSuccess",this.handleUnlockSuccess),f.off("click",".scrambled-notifier",this.handleScrambledTextClick),this.unsubscribeParagraphUnlockEvents(),$(".scrambled").off(),$(document.body).removeClass("unlock-supported")},e.prototype.disableParagraphByParagraphUnlock=function(){this.unsubscribeParagraphUnlockEvents()},e.prototype.getParagraphsPrice=function(e){var t=this;if(null!=e&&0!=e.length&&null!=this.bookElement&&null!=this.bookElement.bookElementPriceInfo){var n=0;return e.forEach((function(e){return n+=t.getParagraphPrice(e)})),Math.max(n,0)}},e.prototype.getParagraphPrice=function(e){if(null==this.bookElement||null==this.bookElement.bookElementPriceInfo)return 0;if(!e||!e.length)return 0;var t=(this.bookElement.wordCount||0)-(this.bookElement.freeWordCount||0);if(!(t<=0)){var n=this.bookElement.bookElementPriceInfo.fullTokenPrice;if(!(n<=0)){var o=e.text();return e.find(".scrambled-notifier").length&&(o=o.replace(e.find(".scrambled-notifier").text(),"")),Math.max(Math.ceil(c.a.getNumberOfWords(o)/t*1.2*n),0)}}},e.prototype.showHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","flex")},e.prototype.hideHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","none")},e.prototype.unsubscribeParagraphUnlockEvents=function(){f.off("mouseenter",".readable-text.scrambled",this.handleMouseEnter),f.off("mouseleave",".readable-text.scrambled",this.handleMouseLeave),f.off("click",".scrambled-notifier",this.handleScrambledTextClick)},e.prototype.handleHeadingMouseEnter=function(e){$(e.currentTarget).find(".heading-scrambled-notifier").removeClass("heading-scrambled-notifier-hidden")},e.prototype.handleMouseEnter=function(e){var t=$(e.currentTarget);if(p||$(".heading-scrambled-notifier").addClass("heading-scrambled-notifier-hidden"),!t.is(".unscrambled, .unscrambling")&&t.is(".scrambled")&&!s.a.isFreePreviewActive())if(t.is("li")){var n=o.a.expandListOfScrambledParagraphsIfNecessary([t]);n.length>1?this.addScrambleParagraphNotifierHtml(t.parent()):this.addScrambleParagraphNotifierHtml(t),n.forEach((function(e){return e.addClass("unscramble-target")}))}else this.addScrambleParagraphNotifierHtml(t),t.addClass("unscramble-target")},e.prototype.handleMouseLeave=function(e){var t=$(e.currentTarget);t.find(".scrambled-notifier").remove(),t.is("li")&&t.parent().find(".scrambled-notifier").remove(),$(".unscramble-target").removeClass("unscramble-target")},e.prototype.addScrambleParagraphNotifierHtml=function(e){if(e&&e.length&&0==e.find(".scrambled-notifier").length){var t=0;if(e.is("ul, ol")){var n=[];e.children().each((function(e,t){n.push($(t))})),t=this.getParagraphsPrice(n)}else t=this.getParagraphPrice(e);t>0&&e.append(this.generateScrambledParagraphNotifierHTML(t))}},e.prototype.handleUnlockSuccess=function(e,t){var n=this;t!=l.a.FreePreview&&"FreePreview"!=t&&r.a.setTimeout((function(){n.book&&n.bookElement&&n.book.shortName&&n.bookElement.shortName&&d.a.getCompleteBookElementPriceInfo(n.book.shortName,n.bookElement.shortName,n.bookElement.meapVersion).then((function(e){null!=e&&0!=e.tokenPrice&&(n.bookElement.bookElementPriceInfo=e,n.$headings.each((function(e,t){var r=$(t),i=o.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,r,n.$headings);0!=i?r.find(".price-container").text(i):r.find(".scrambled-notifier").remove()})))})).catch((function(e){console.log("Cannot get book element price info")}))}),50)},e.prototype.handleUnlockHeadingClick=function(e){var t=$("#"+$(e.currentTarget).attr("data-heading-id"));u.a.showModalForCurrentBookElementPurchases(t)},e.prototype.generateScrambledParagraphNotifierHTML=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var o="";o=t?i.a.isChapterOrAppendix(n)?"unlock whole chapter":"unlock whole section":"unlock this paragraph";var r=a.b.isTouchDevice()?"tap":"click";return t?'<div class="scrambled-notifier heading-scrambled-notifier '+(p?"":"heading-scrambled-notifier-hidden")+' unlock-notifier" title="'+o+'">\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+"</span>\n                        </div>\n                    </div>":'<div class="scrambled-notifier paragraph-scrambled-notifier unlock-notifier '+(e>9?"contains-double-digit-tokens":"")+'" title="'+o+'">\n                        <span class="scramble-message-container show-medium-up">'+r+' to unlock! </span>\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+'</span>\n                        </div>\n                        <span class="scrambled-arrow-container"></span>\n                    </div>'},e.prototype.getRelevantScrambledParagraph=function(e){if(e)try{var t=$(e).closest(".readable-text");if(t.is(".scrambled")&&!t.is("li"))t[0];else{var n=parseInt(t.attr("refid"));if(Number.isNaN(n))return null;for(var o=n+1;o<n+10;o++){if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}for(o=n-1;o>n-10;o--){var r;if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}}}catch(e){}return null},e.prototype.handleScrambledTextClick=function(e){if(!$(e.target).is("a")&&!$(document.body).is(".free-preview-mode")){var t=$(e.currentTarget);t.is(".scrambled")?u.a.showModalForCurrentBookElementPurchases(null,o.a.expandListOfScrambledParagraphsIfNecessary([t])):t.is(".scrambled-notifier.heading-scrambled-notifier")&&u.a.showModalForCurrentBookElementPurchases(t.closest(".readable-text"))}},e}())},345:function(e,t,n){"use strict";n.r(t);var o,r=n(357),i=n(360),a=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e){function t(t){var n=e.call(this,t||"Promise was canceled")||this;return n.name="CancelError",n}return a(t,e),Object.defineProperty(t.prototype,"isCanceled",{get:function(){return!0},enumerable:!0,configurable:!0}),t}(Error),s=function(){function e(e){var t=this;this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._promise=new Promise((function(n,o){return t._reject=o,e((function(e){t._isPending=!1,n(e)}),(function(e){t._isPending=!1,o(e)}),(function(e){t._cancelHandlers.push(e)}))}))}return e.fn=function(t){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new e((function(e,o,r){n.push(r),t.apply(void 0,n).then(e,o)}))}},e.prototype.then=function(e,t){return this._promise.then(e,t)},e.prototype.catch=function(e){return this._promise.catch(e)},e.prototype.finally=function(e){return this._promise.finally(e)},e.prototype.cancel=function(e){if(this._isPending&&!this._isCanceled){if(this._cancelHandlers.length>0)try{for(var t=0,n=this._cancelHandlers;t<n.length;t++){(0,n[t])()}}catch(e){this._reject(e)}this._isCanceled=!0,this._reject(new c(e))}},Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),e}(),l=s;Object.setPrototypeOf(s.prototype,Promise.prototype);var u=n(550),d=n.n(u),f=n(0),p=n(9),m=n(3),h=n(410),k=n(57),g=n(15),b=n(128),v=n(593),y=n(344),C=n(4),T=n(29),I=n(75),E=n(129),P=function(){function e(e){this.$readableTexts=e,E.b.markParagraphsForUnscrambling(e)}return e.prototype.startUnlockAnimation=function(){this.fadeOutAllText()},e.prototype.revertAnimation=function(){this.fadeInAllText()},e.prototype.fadeOutAllText=function(){var e=this,t=$($.map(this.$readableTexts,(function(e){return e.get()})));t.velocity({opacity:0},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||t.velocity({opacity:1},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||e.fadeOutAllText()}})}})},e.prototype.fadeInAllText=function(){var e=$($.map(this.$readableTexts,(function(e){return e.get()})));e.velocity("stop"),e.velocity({opacity:1},{duration:250})},e.prototype.insertUnscrambledContent=function(e){for(var t=function(t){var o=n.$readableTexts[t],r=o.attr("refid"),i=e.find((function(e){return e.paragraphID==r}));i&&(o.html(i.content),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.find(".scrambled-notifier").remove(),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.attr("data-original-html",""))},n=this,o=0;o<this.$readableTexts.length;o++)t(o)},e.prototype.unlockWithAnimations=function(e){this.fadeInAllText(),e&&e()},e}(),w=n(14),S=n(81),x=n(7);n.d(t,"UnlockContentManager",(function(){return A}));var O=$(document),A=new(function(){function e(){var e=this;this.$unscrambleInfoModal=$("#unscramble-info-modal"),0==this.$unscrambleInfoModal.length&&($(document.body).append(M),this.$unscrambleInfoModal=$("#unscramble-info-modal")),m.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".add-to-cart-button",(function(){return e.addCurrentBookToCart()})),m.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".view-in-cart-button",(function(){e.hideOutOfTokensModal(),setTimeout((function(){return I.a.requestMenuOpen()}),300)})),m.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".buy-tokens-button",(function(){e.hideOutOfTokensModal()})),O.on("shoppingCartItemsChanged",(function(){return e.updatePurchaseButtons()}))}return e.prototype.initialize=function(e,t){this.book=e,this.bookElement=t,this.fetchAndDisplayLatestTokenInfo()},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.fetchAndDisplayLatestTokenInfo=function(e){var t=this;void 0===e&&(e=!1),x.a.isCurrentlyLoggedIn()?h.a.getTokenCountInfo(e).then((function(e){t.refreshTokenStateInToolbar(e)})).catch((function(e){t.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})})):this.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})},e.prototype.tryToSearchUnlockFragmentInCurrentBookElement=function(e){this.unlockFragments(this.book,this.bookElement,E.a.Search,"",e)},e.prototype.tryToUnlockTocBookElement=function(e,t,n){var o=this;x.a.isLoggedIn().then((function(r){r.loggedIn?o.hasEnoughTokens(n,r.userDetails&&r.userDetails.tokenInfo)?(k.a.showTemporaryNotification("Unlocking content ..."),o.getUnlockTocBookElementPromise(e,t).then((function(e){O.trigger("unlockSuccess",[E.a.BookElement]),k.a.showTemporaryNotification("Unlock success. Loading "+t+"."),m.a.setTimeout((function(){b.a.openLink(b.a.formLinkFromBookSlugAndBookElementShortName(o.book.slug,t)),f.a.reloadPage()}),2e3)})).catch((function(e){O.trigger("unlockFailure",[E.a.BookElement,[]]),k.a.showTemporaryNotification("Error unlocking "+t+". Try later.")}))):o.showOutOfTokensModal():o.showLoginModal("Want to see more? Just sign in and use tokens to unlock this content.")}))},e.prototype.hasEnoughTokens=function(e,t){return null!=t&&this.getTotalNumberOfTokens(t)>=e},e.prototype.unlockFragments=function(e,t,n,o,r,i,a,c){var s=this;return new l((function(l,u,d){x.a.isLoggedIn().then((function(f){var p=n==E.a.Search,m=n==E.a.FreePreview;if(f.loggedIn||m){var g=r.map((function(e){return e.attr("id")})),b=a||s.getTokenCost(r);s.getTotalNumberOfTokens(f.userDetails&&f.userDetails.tokenInfo);if(m||p||s.hasEnoughTokens(b,f.userDetails&&f.userDetails.tokenInfo)){var C=s.unlockContent(t,n,o,g,c).then((function(e){E.b.replaceEncryptedContent($("body"),e.ownedContent||e.unlockedParagraphs),O.trigger("paragraphsUnlocked",[g]),p||m||null!=e.tokenInfo&&(h.a.setTokenCountInfo(e.tokenInfo),s.refreshTokenStateInToolbar(e.tokenInfo)),O.trigger("unlockSuccess",[E.a[n]]),l(e),setTimeout((function(){e.licenseCreated?v.TokenModal.renderLicenceCreatedModal():e.productTokenInfo&&e.productTokenInfo.spentAmountInDollars&&e.productTokenInfo.spentAmountInTokens&&I.a.getBookPrice(s.book).then((function(t){e.productTokenInfo.spentAmountInDollars>=.25*t&&v.TokenModal.renderUpsellModal(!0,s.book,e.productTokenInfo.spentAmountInTokens,e.productTokenInfo.spentAmountInDollars)}))}),100)})).catch((function(t){var o="Error when unlocking content";p?o="Unfortunatly, you've exceeded the search unscrambling limit for this book. Try again tomorrow.":m&&(o="Unfortunatly, you've exceeded the free preview limit for this book. Try again tomorrow."),null!=t.remainingPreviewDuration&&t.remainingPreviewDuration<0||(k.a.showTemporaryNotification(o),O.trigger("unlockFailure",[E.a[n],g]),u(t),t&&t.outOfSingleParagraphUnlocks&&(O.trigger("outOfParagraphByParagraphUnlocks"),v.TokenModal.renderOutOfParagraphByParagraphUnlocks(!0,t.reason),y.UnlockText.disableParagraphByParagraphUnlock(),e&&(e.isParagraphByParagraphUnlockDisabled=!0)))}));d((function(){return C&&C.cancel()}))}else s.showOutOfTokensModal()}else s.showLoginModal("Want to see more? Just sign in"+(n==E.a.Search?" and the paragraph will unlock for you.":" and use tokens to unlock this content.")),s.setOriginalLinkLocation(i)}))}))},e.prototype.tryToUnlockPointedParagraph=function(e,t,n,o){var r=this;if(e&&t&&n&&!(n.length<2)){var i=E.b.getDataFromPointingLink(e,t,n);if(null!=i){for(var a=[],c=i.startParagraphId;c<=i.endParagraphId;c++){var s=document.getElementById(c);s&&a.push($(s))}var l=E.b.isEncompassingWholeContent(i.startParagraphId,i.endParagraphId);l||a.forEach((function(e){return e.addClass("paragraph-selected")}));var u=a.filter((function(e){return e.is(".scrambled")}));i.paragraphsToUnlock=u.map((function(e){return e.attr("id")})).join(","),O.trigger("pointingLinkOpened",[i.pointingLinkId,l]),u.length?x.a.isLoggedIn().then((function(t){if(t.loggedIn)if(i.isUserEditorLink)r.unlockPointedParagraphs(e,u,i.startParagraphId,i.endParagraphId,i);else{var n=Math.max(r.getTokenCost(u),1);if(!(r.getTotalNumberOfTokens(t.userDetails&&t.userDetails.tokenInfo)>=n))return void k.a.showTemporaryNotification("You don't have enough tokens to unlock the whole pointed content");k.a.showNotificationModal("Confirm","Spend "+n+" "+(n>1?"tokens":"token")+" to unlock this content?",!0,(function(){return r.unlockPointedParagraphs(e,u,i.startParagraphId,i.endParagraphId,i)}))}else r.showLoginModal("Want to see more? Just sign in."),r.setOriginalLinkLocation(o)})):i.pointingLinkId&&this.reportPointingLinkUsed(i.pointingLinkId)}}},e.prototype.unlockPointedParagraphs=function(e,t,n,o,r){var i=this,a=new P(t);a.startUnlockAnimation(),f.a.getFromOurBackend(f.a.getAbsoluteUrl("api/pointing/getPointedContent"),(function(e){a.insertUnscrambledContent(e.paragraphInfos||[]),a.unlockWithAnimations(),O.trigger("unlockSuccess",[E.a[E.a.Point]]),null!=e.tokenInfo&&(h.a.setTokenCountInfo(e.tokenInfo),i.refreshTokenStateInToolbar(e.tokenInfo))}),(function(e){k.a.showNotification("Error when trying to unlock. Please try later."),O.trigger("unlockFailure",[!1,!0,[n,o]]),a.revertAnimation()}),r)},e.prototype.reportPointingLinkUsed=function(e){f.a.getFromOurBackend(f.a.getAbsoluteUrl("api/pointing/reportSimpleUse"),(function(e){}),(function(e){}),{pointingLinkId:e})},e.prototype.unlockContent=function(e,t,n,o,r){var i=this;return void 0===r&&(r={}),new l((function(a,c,s){var l=new P(o.map((function(e){return $(document.getElementById(e))})));l.startUnlockAnimation(),Promise.all([i.getUnlockBookElementContentPromise(e,t,n,o,r),C.a.getTimeoutPromise(500)]).then((function(e){var n=e[0];if(!n.success)return null!=l&&l.revertAnimation(),void c(n);n.tokenInfo&&i.refreshTokenStateInToolbar(n.tokenInfo),t==E.a.BookElement&&$(".heading-scrambled-notifier").remove(),l.insertUnscrambledContent(n.ownedContent||n.unlockedParagraphs),l.unlockWithAnimations((function(){return a(n)}))})).catch((function(e){null!=l&&l.revertAnimation(),c(e)}))}))},e.prototype.getUnlockTocBookElementPromise=function(e,t){var n=this;return new Promise((function(o,r){f.a.postToOurBackend(f.a.getAbsoluteUrl("api/userBook/unlockTocBookElement"),(function(e){return o(e)}),(function(e){return r(e)}),{bookShortName:e.shortName,bookElementShortName:t,meapVersion:n.bookElement.meapVersion})}))},e.prototype.getUnlockBookElementContentPromise=function(e,t,n,o,r){var i=this;return new l((function(a,c,s){S.a.getAbTestVariant().then((function(s){var l=i.getUnlockBookElementContentApiSendData(e,t,n,o,r);l.durationVariant=s,f.a.postToOurBackend(f.a.getAbsoluteUrl("api/userBook/unlockBookElementContent"),(function(t){t&&(t.ownedContent?i.fixOwnedContentImages(t.ownedContent):t.unlockedParagraphs&&i.fixOwnedContentImages(t.unlockedParagraphs),t.productTokenInfo&&e.book&&(e.book.spendingInfo={spentTokenAmount:t.productTokenInfo.spentAmountInTokens,spentDollarAmount:t.productTokenInfo.spentAmountInDollars},O.trigger("bookSpendingInfoArrived"))),a(t)}),(function(e){return c(e)}),l)}))}))},e.prototype.getUnlockBookElementContentApiSendData=function(e,t,n,o,r){var i={bookShortName:e.book.shortName,bookElementShortName:e.shortName,paragraphIDs:(o||[]).join(","),meapVersion:e.meapVersion,isSearch:t==E.a.Search,isFreePreview:t==E.a.FreePreview,logTimings:!!w.a.getItem("logTimings")};switch(t){case E.a.BookElement:delete i.paragraphIDs;break;case E.a.Section:i.sectionShortName=n;break;case E.a.Subsection:i.subsectionShortName=n}try{if(r&&r instanceof Object)for(var a in r)i[a]=r[a]}catch(e){console.log("Error when adding additional parameters when unlocking")}return i},e.prototype.fixOwnedContentImages=function(e){if(!e)return e;for(var t=0;t<e.length;t++)e[t].content=e[t].content.replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,f.a.getAwsPublic())},e.prototype.addCurrentBookToCart=function(){I.a.requestAddBookToCart(this.book)},e.prototype.updatePurchaseButtons=function(){this.book?(this.$unscrambleInfoModal.find(".add-to-cart-button").toggleClass("hidden",this.book.userOwnsBook||I.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".view-in-cart-button").toggleClass("hidden",!I.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".buy-tokens-button").toggleClass("hidden",!0)):this.$unscrambleInfoModal.find(".add-to-cart-button, .buy-tokens-button, .view-in-cart-button").addClass("hidden")},e.prototype.refreshTokenStateInToolbar=function(e){var t=$(".token-amount-container"),n=parseInt(t.first().text().replace(",","")||"0");Number.isNaN(n)&&(n=0);var o=(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0);if(0==o||0==n||0==t.filter(":visible").length)t.each((function(e,t){i.unmountComponentAtNode(t)})),t.html(""+C.a.numberWithCommas(o||""));else try{i.render(r.createElement(d.a,{start:n,end:o,duration:1.5,separator:",",onStart:function(){n!=o&&t.addClass("counting glow-text")},onEnd:function(){t.removeClass("counting glow-text")}}),t.filter(":visible")[0])}catch(e){t.each((function(e,t){i.unmountComponentAtNode(t)})),t.html(""+(o||""))}},e.prototype.showLoginModal=function(e){void 0===e&&(e=""),T.a.requestOpenModal("signin",e,"microtransactions")},e.prototype.showOutOfTokensModal=function(){v.TokenModal.renderOutOfTokensNotifier(this.book),this.updatePurchaseButtons()},e.prototype.hideOutOfTokensModal=function(){p.a.hideFoundationModal(this.$unscrambleInfoModal)},e.prototype.getTotalNumberOfTokens=function(e){return null==e?0:(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0)},e.prototype.getTokenCost=function(e){return y.UnlockText.getParagraphsPrice(g.a.expandListOfScrambledParagraphsIfNecessary(e.filter((function(e){return e.is(".scrambled")}))))},e.prototype.setOriginalLinkLocation=function(e){e&&m.a.setTimeout((function(){e&&history.pushState({},document.title,e)}),400)},e}()),M='<div id="unscramble-info-modal" class="reveal-modal" data-reveal>\n    <span class="close-reveal-modal">&times;</span>\n    <div class="row">\n        <div class="small-12 columns unscramble-info-modal-content-container">\n            {{{UNSCRAMBLE_INFO_CONTENT}}}\n        </div>\n    </div>\n</div>'},355:function(e,t,n){"use strict";n.r(t);var o,r=n(357),i=n(360),a=n(57),c=n(77),s=n(15),l=n(16),u=n(6),d=n(358),f=n(363),p=(n(957),n(411)),m=n(368),h=n(127),k=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),g=function(e){function t(t){var n=e.call(this,t)||this;return n.state={currentConfirmationItem:null},n.updatedCurrentConfirmationItem=n.updatedCurrentConfirmationItem.bind(n),n}return k(t,e),t.prototype.render=function(){var e=this;return r.createElement(f.b,{mainContainerClassName:"unlock-confirm-modal",isOpen:this.props.isShown,onClose:function(t){return e.handleClose()},title:null!=this.state.currentConfirmationItem?"confirm":"get content",initialOverlayTop:this.props.topOffset},this.props.isLoading&&r.createElement("div",{style:{height:200}},r.createElement(p.a,null)),this.props.isShown&&!this.props.isLoading&&r.createElement("div",{className:"unlock-confirm-root"},null!=this.state.currentConfirmationItem?r.createElement(b,{confirmationItem:this.state.currentConfirmationItem,onBackRequested:function(){return e.updatedCurrentConfirmationItem(null)},onConfirmationItemSelected:this.props.onConfirmationItemSelected,confirmationLimit:this.props.confirmationLimit,isInConfirmationMode:!0}):this.props.confirmationItems.map((function(t){return r.createElement(b,{key:t.id,confirmationItem:t,onConfirmationItemSelected:e.props.onConfirmationItemSelected,confirmationLimit:e.props.confirmationLimit,onConfirmationRequested:e.updatedCurrentConfirmationItem})})),this.props.productPrice>0&&null==this.state.currentConfirmationItem&&r.createElement("div",{key:"unlock-confirm-action",className:"unlock-confirm-option-row unlock-confirm-action-row"},r.createElement("div",{className:d("unlock-confirm-select-box unlock-confirm-action-container",{"product-in-cart":this.props.isProductAlreadyInCart}),onClick:function(t){return e.props.onCartActionSelected&&e.props.onCartActionSelected()}},r.createElement("div",{style:{display:"inline-block"}},this.generatePurchaseWholeProductMessage()),!this.props.isProductAlreadyInCart&&r.createElement("div",{className:"unlock-confirm-action-price-container"},this.generatePossibleTokenDiscounts(),r.createElement("strong",{className:"unlock-confirm-price-label"},"$",h.a.roundToTwoDecimalPlaces(this.props.productPrice-(this.props.productAlreadySpentDollars||0))))))))},t.prototype.generatePossibleTokenDiscounts=function(){if(this.props.productAlreadySpentDollars>0&&this.props.productAlreadySpentTokens>0)return r.createElement("span",{className:"unlock-confirm-discount-container","data-tip":"you've already spent "+this.props.productAlreadySpentTokens+" token(s) on this product","data-effect":"solid"},r.createElement("span",{className:"unlock-confirm-discount-label"},"$",h.a.roundToTwoDecimalPlaces(this.props.productPrice)," ",r.createElement("strong",null,"- $",h.a.roundToTwoDecimalPlaces(this.props.productAlreadySpentDollars)," deduction")),r.createElement("i",{className:"fa fa-caret-right unlock-confirm-discount-label","aria-hidden":"true"}))},t.prototype.generatePurchaseWholeProductMessage=function(){return r.createElement(r.Fragment,null," ",this.props.isProductAlreadyInCart?" view ":this.props.isBuyMessage?" buy ":" add ",r.createElement("em",null,this.props.productTitle),this.props.isProductAlreadyInCart?" in ":this.props.isBuyMessage?" ":" to ",this.props.isBuyMessage?"":"your cart")},t.prototype.handleClose=function(){this.setState({currentConfirmationItem:null}),this.props.onClose&&this.props.onClose()},t.prototype.updatedCurrentConfirmationItem=function(e){this.setState({currentConfirmationItem:e})},t}(r.Component),b=function(e){function t(t){return e.call(this,t)||this}return k(t,e),t.prototype.render=function(){var e=this,t=this.props.confirmationItem;return this.props.isInConfirmationMode?r.createElement("div",{className:"unlock-confirm-option-row"},r.createElement("div",{title:"Back",className:"unlock-confirm-back-container",onClick:function(t){return e.props.onBackRequested&&e.props.onBackRequested()}},r.createElement("i",{className:"fa fa-caret-left","aria-hidden":"true"})),r.createElement("div",{title:"Confirm unlocking this part for "+h.a.numberWithCommas(t.price)+" token"+(t.price>1?"s":""),className:"unlock-confirm-box unlock-confirm-select-box",onClick:function(t){return e.handleItemClick()}},r.createElement("em",null,"confirm purchase of "),this.shortenTextIfNecessary(t.text,!1),r.createElement("em",null," for "),r.createElement("span",{className:"unlock-confirm-type-container"},r.createElement("svg",{viewBox:"0 0 10.583333 10.583334",dangerouslySetInnerHTML:{__html:'<use xlink:href="#token-icon">'}})),r.createElement("strong",{className:"unlock-confirm-price-label"},h.a.numberWithCommas(t.price)))):r.createElement("div",{className:"unlock-confirm-option-row",title:"Unlock this part for "+h.a.numberWithCommas(t.price)+" token"+(t.price>1?"s":""),onClick:function(t){return e.handleItemClick()}},r.createElement("div",{className:"unlock-confirm-select-box"},r.createElement("div",{className:"unlock-confirm-select-box-left"},r.createElement("em",null," unlock ",this.props.confirmationItem.isParagraph?"paragraph: ":""),this.shortenTextIfNecessary(t.text)),r.createElement("div",{className:"unlock-confirm-price-container"},r.createElement("span",{className:"unlock-confirm-type-container"},r.createElement("svg",{viewBox:"0 0 10.583333 10.583334",dangerouslySetInnerHTML:{__html:'<use xlink:href="#token-icon">'}})),r.createElement("strong",{className:"unlock-confirm-price-label"},h.a.numberWithCommas(t.price)))))},t.prototype.shortenTextIfNecessary=function(e,t){if(void 0===t&&(t=!0),!e)return e;e.length>=150&&(e=e.substring(0,150)+" ...");var n=m.a.splitIntoShortNameAndContent(e);return n?r.createElement(r.Fragment,null,r.createElement("span",{className:"unlock-confirm-deemphasized-label"},n.shortName," "),t&&r.createElement("span",null,n.content)):e},t.prototype.handleItemClick=function(){this.props.confirmationItem.price>=this.props.confirmationLimit||this.props.confirmationItem.needsConfirmation?this.props.isInConfirmationMode?this.props.onConfirmationItemSelected&&this.props.onConfirmationItemSelected(this.props.confirmationItem):this.props.onConfirmationRequested&&this.props.onConfirmationRequested(this.props.confirmationItem):this.props.onConfirmationItemSelected&&this.props.onConfirmationItemSelected(this.props.confirmationItem)},t}(r.Component),v=n(376),y=n(552),C=(n(959),n(440),n(365)),T=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),I=function(e){function t(t){var n=e.call(this,t)||this;return n.handleAcceptClick=n.handleAcceptClick.bind(n),n.state={isAcknowledged:!1},n}return T(t,e),t.prototype.render=function(){var e=this;return r.createElement(y.a,{mainContainerClassName:"token-modal token-meap-notification-modal",title:"MEAPS & Tokens",isShown:this.props.isShown,onClose:this.props.onClose,topOffset:this.props.topOffset,theme:f.a.red},r.createElement("p",null,this.props.message||"You are purchasing Manning Early Access Program content. \n                        MEAPs change during development - sections are modified, moved around, and sometimes deleted. \n                        Older MEAP versions will remain in livebook but newer versions may not contain your paid content. \n                        Please have that in mind if you want to continue."),r.createElement("p",null,r.createElement("label",null,r.createElement("input",{type:"checkbox",checked:this.state.isAcknowledged,onChange:function(t){return e.setState({isAcknowledged:t.currentTarget.checked})}}),"I understand")),r.createElement("span",{className:d("tokens-button",{disabled:!this.state.isAcknowledged}),onClick:this.handleAcceptClick,"data-tip":this.state.isAcknowledged?"":"tick the checkbox to proceed"},"accept"),r.createElement("span",{className:"tokens-button cancel-button",onClick:this.props.onClose},"cancel"),!C.a.isTouch&&r.createElement(v,{effect:"solid",place:"bottom"}))},t.prototype.handleAcceptClick=function(){this.state.isAcknowledged&&this.props.onAccept&&this.props.onAccept()},t}(r.Component),E=n(14),P=n(4),w=n(1),S=n(75),x=n(345),O=n(129),A=n(25);n.d(t,"UnlockModalClass",(function(){return N})),n.d(t,"UnlockModal",(function(){return B}));var M=$(document),N=function(){function e(){var e=this;M.on("requestModalForCurrentBookElementPurchases",(function(t,n){e.showModalForCurrentBookElementPurchases($(n))})),M.on("requestModalForTocBookElementPurchase",(function(t,n,o){e.showModalForTocBookElementPurchase(n,o)}))}return e.prototype.initialize=function(e,t){this.book=e,this.bookElement=t},e.prototype.clean=function(){this.book=null,this.bookElement=null,i.unmountComponentAtNode(document.getElementById("full-screen-modal"))},e.prototype.showModalForTocBookElementPurchase=function(e,t){var n=this;this.items=[],this.isTocUnlock=!0,this.showMeapNotifierIfNecessary((function(){a.a.hideNotificationModal(),n.renderConfirmationModal(!0,!0),A.a.getBookElementTokenPrice(n.book.shortName,e,n.bookElement.meapVersion).then((function(o){n.items=[{id:e,text:t,price:o}],a.a.hideNotificationModal(),n.renderConfirmationModal(!0,!1)})).catch((function(t){n.renderConfirmationModal(!1),a.a.showTemporaryNotification("Error getting "+e+" price")}))}))},e.prototype.showModalForCurrentBookElementPurchases=function(e,t){var n=this;void 0===t&&(t=null),this.isTocUnlock=!1,null!=(null!=t&&t.length>0?t[0][0]:s.a.getContainedScrambledAndUnscrambledParagraphs(e,s.a.getHeadings()).scrambledParagraphs[0])&&this.showMeapNotifierIfNecessary((function(){n.items=n.convertToMicrotransactionConvertItems(e,t),a.a.hideNotificationModal(),n.renderConfirmationModal()}))},e.prototype.showMeapNotifierIfNecessary=function(e){var t=this;null!=this.book&&this.book.isMeap&&!this.hasAlreadyAcceptedMicrotransactionNotification()?i.render(r.createElement(I,{isShown:!0,topOffset:u.a.getNavbarHeightInPx(),onClose:function(){return t.hideTokenNotifier()},onAccept:function(){t.hideTokenNotifier(),t.storeThatUserAcceptedMicrotransactionNotification(),e&&e()}}),document.getElementById("full-screen-modal")):e&&e()},e.prototype.hasAlreadyAcceptedMicrotransactionNotification=function(){try{return-1!=JSON.parse(E.a.loadTemporarily("accepted-microtransactions-notification-books")||"[]").indexOf(this.book.shortName)}catch(e){}return!1},e.prototype.storeThatUserAcceptedMicrotransactionNotification=function(){try{var e=JSON.parse(E.a.loadTemporarily("accepted-microtransactions-notification-books")||"[]");e.push(this.book.shortName),E.a.saveTemporarily("accepted-microtransactions-notification-books",JSON.stringify(e),6048e5)}catch(e){}},e.prototype.hideTokenNotifier=function(){i.render(r.createElement(I,{isShown:!1}),document.getElementById("full-screen-modal"))},e.prototype.renderConfirmationModal=function(e,t){var n=this;void 0===e&&(e=!0),void 0===t&&(t=!1),e?(i.render(r.createElement(g,{isShown:e,isLoading:!0,confirmationItems:this.items,productTitle:s.a.cleanBookTitle(this.book.title),isProductAlreadyInCart:S.a.isEbookInShoppingCart(this.book),productPrice:0,onConfirmationItemSelected:function(e){return n.handleConfirmMicropurchaseClick(e)},onCartActionSelected:function(e){return n.handleCartAction()},onClose:function(e){return n.hide()},topOffset:u.a.getNavbarHeightInPx()}),document.getElementById("full-screen-modal")),Promise.all([S.a.getBookPrice(this.book),S.a.getProductSpendingInfo(this.book)]).then((function(o){var a=o[0],c=o[1];i.render(r.createElement(g,{isShown:e,isLoading:t,confirmationItems:n.items,productTitle:s.a.cleanBookTitle(n.book.title),isProductAlreadyInCart:S.a.isEbookInShoppingCart(n.book),onConfirmationItemSelected:function(e){return n.handleConfirmMicropurchaseClick(e)},onCartActionSelected:function(e){return n.handleCartAction()},onClose:function(e){return n.hide()},productAlreadySpentTokens:c.spentTokenAmount,productAlreadySpentDollars:P.a.roundToTwoDecimalPoints(c.spentDollarAmount),productPrice:a,topOffset:u.a.getNavbarHeightInPx()}),document.getElementById("full-screen-modal"))})).catch((function(o){i.render(r.createElement(g,{isShown:e,isLoading:t,confirmationItems:n.items,productTitle:n.book.title,isProductAlreadyInCart:S.a.isEbookInShoppingCart(n.book),onConfirmationItemSelected:function(e){return n.handleConfirmMicropurchaseClick(e)},onCartActionSelected:function(e){return n.handleCartAction()},onClose:function(e){return n.hide()},productPrice:0,topOffset:u.a.getNavbarHeightInPx()}),document.getElementById("full-screen-modal"))}))):i.render(r.createElement(g,{isShown:e,isLoading:t,confirmationItems:this.items,productTitle:s.a.cleanBookTitle(this.book.title),isProductAlreadyInCart:S.a.isEbookInShoppingCart(this.book),productPrice:0,onConfirmationItemSelected:function(e){return n.handleConfirmMicropurchaseClick(e)},onCartActionSelected:function(e){return n.handleCartAction()},onClose:function(e){return n.hide()},topOffset:u.a.getNavbarHeightInPx()}),document.getElementById("full-screen-modal"))},e.prototype.hide=function(){this.items=[],this.renderConfirmationModal(!1)},e.prototype.handleCartAction=function(){var e=this;S.a.isEbookInShoppingCart(this.book)?(this.hide(),setTimeout((function(){return S.a.requestMenuOpen()}),150)):(S.a.requestAddBookToCart(this.book),setTimeout((function(){return e.renderConfirmationModal()})))},e.prototype.handleConfirmMicropurchaseClick=function(e){this.hide(),this.isTocUnlock?this.unlockBookElement(e.id,e.price):this.unlockParagraphs(this.getParagraphsToUnlockFromItemId(e.id),this.getUnlockType(e.id),this.getOptionalContentId(e.id),e.price)},e.prototype.getParagraphsToUnlockFromItemId=function(e){var t=e.split(",");if(0==t.length)return[];if(1==t.length){var n=$(document.getElementById(t[0]));if(0!=n.find("h1, h2, h3, h4, h5").length)return s.a.getContainedScrambledAndUnscrambledParagraphs(n,s.a.getHeadings()).scrambledParagraphs}return t.map((function(e){return document.getElementById(e)}))},e.prototype.getUnlockType=function(e){var t=e.split(",");if(0==t.length)return O.a.Paragraphs;if(1==t.length){var n=$(document.getElementById(t[0]));if(0!=n.find("h1, h2, h3, h4, h5").length){var o=n.text().trim();if(l.a.isChapterOrAppendix(o))return O.a.BookElement;if(l.a.isSection(o))return O.a.Section;if(l.a.isSubsection(o))return O.a.Subsection}}return O.a.Paragraphs},e.prototype.getOptionalContentId=function(e){var t=e.split(",");if(0==t.length)return"";if(1==t.length){var n=$(document.getElementById(t[0]));if(0!=n.find("h1, h2, h3, h4, h5").length){var o=n.text().trim();if(l.a.isChapterOrAppendix(o))return"";if(l.a.isSection(o)||l.a.isSubsection(o))return l.a.extractNumbering(o)}}return""},e.prototype.unlockBookElement=function(e,t){x.UnlockContentManager.tryToUnlockTocBookElement(this.book,e,t)},e.prototype.unlockParagraphs=function(e,t,n,o){var r=this;c.a.scrollToElement(e[0],(function(){return x.UnlockContentManager.unlockFragments(r.book,r.bookElement,t,n,e.map((function(e){return $(e)})),"",o).then((function(){t==O.a.Section||t==O.a.Subsection?M.trigger("unlockSectionSubsectionSuccess",[r.book.shortName,r.bookElement.shortName,n]):t==O.a.BookElement?M.trigger("unlockBookElementSuccess",[r.book.shortName,r.bookElement.shortName,n]):t==O.a.Paragraphs&&M.trigger("unlockParagraphSuccess",[r.book.shortName,r.bookElement.shortName,n])})).catch((function(e){}))}))},e.prototype.convertToMicrotransactionConvertItems=function(e,t){var n=this,o=s.a.getHeadings();if(null!=t&&t.length>0){var r=[],i=[],a="";if(t.forEach((function(e){var t=$(e);a+=t.text(),i.push(t.attr("refid"))})),r.push({id:i.join(","),text:a,price:x.UnlockContentManager.getTokenCost(t),isParagraph:!0}),this.book){var c=[];if(w.b.isMediumOrLargeScreenSize()){var u=s.a.getClosestHeading(t[0],o);if(null!=u&&!l.a.isChapterOrAppendix(u.text().trim()))if(c.push(u),l.a.isSubsection(u.text().trim()))null!=(d=s.a.getOwnerSectionHeading(u,o))&&c.push(d)}c.push(s.a.getHeadings().first()),c.forEach((function(e){r.push({id:e.attr("refid"),text:e.find("h1, h2, h3, h4, h5").text(),price:s.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,e,o)})}))}return r}if(null!=e&&e.length>0){var d,f=[];return null==e&&null!=t&&t.length>0&&(e=s.a.getClosestHeading(t[0],o)),"1"!=e.attr("refid")&&f.push(e),null!=(d=s.a.getOwnerSectionHeading(e,o))&&f.push(d),f.push(o.first()),f.map((function(e){return{id:e.attr("refid"),text:e.find("h1, h2, h3, h4, h5").text(),price:s.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,e,o)}}))}return[]},e}(),B=new N},410:function(e,t,n){"use strict";var o=n(0),r=n(22),i=n(76),a=n(4),c=n(7),s=n(1),l=n(128),u=function(){function e(){}return e.prototype.getTokenCountInfo=function(e){var t=this;return void 0===e&&(e=!1),e||null==this.currentTokenCountInfo?e||null==this.currentTokenCountInfoPromise?this.currentTokenCountInfoPromise=new Promise((function(n,o){c.a.isLoggedIn(e).then((function(e){e.loggedIn&&e.userDetails.tokenInfo?(t.currentTokenCountInfo=e.userDetails.tokenInfo,n(e.userDetails.tokenInfo)):(t.currentTokenCountInfoPromise=null,o("No token count info"))})).catch((function(e){return o(e)}))})):this.currentTokenCountInfoPromise:Promise.resolve(this.currentTokenCountInfo)},e.prototype.setTokenCountInfo=function(e){this.currentTokenCountInfo=e,r.a.setTokenInfo(e)},e.prototype.getTokenLedgerItems=function(e){var t=this;return void 0===e&&(e=!1),s.b.isApp()&&!s.b.isConnected()?Promise.resolve([]):c.a.isCurrentlyLoggedIn()?e&&this.lastTokenLedger?Promise.resolve(this.lastTokenLedger):new Promise((function(e,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getTokenLedger"),(function(n){var o=n.map((function(e){return{date:a.a.getDateFromString(e.date),quantity:e.quantity,description:e.description,notes:e.notes,link:l.a.adjustBookLink(e.link),isFreeTokensRedemption:"COMPED"==e.type}}));t.lastTokenLedger=o,e(o)}),(function(e){n("Error getting token ledger")}))})):Promise.resolve([])},e.prototype.getTokenCashoutInfo=function(){var e=this;return new Promise((function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getCashoutInfo"),(function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),i.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)}),(function(e){return n("Error getting token ledger")}))}))},e.prototype.cashout=function(){var e=this;return new Promise((function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/cashout"),(function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),i.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)}),(function(e){return n("Error performing token cashout")}))}))},e}();t.a=new u},459:function(e,t,n){var o,r;void 0===(r="function"==typeof(o=function(e,t,n){return function(e,t,n,o,r,i){function a(e){return"number"==typeof e&&!isNaN(e)}var c=this;if(c.version=function(){return"1.9.3"},c.options={useEasing:!0,useGrouping:!0,separator:",",decimal:".",easingFn:function(e,t,n,o){return n*(1-Math.pow(2,-10*e/o))*1024/1023+t},formattingFn:function(e){var t,n,o,r,i,a,s=e<0;if(e=Math.abs(e).toFixed(c.decimals),n=(t=(e+="").split("."))[0],o=t.length>1?c.options.decimal+t[1]:"",c.options.useGrouping){for(r="",i=0,a=n.length;i<a;++i)0!==i&&i%3==0&&(r=c.options.separator+r),r=n[a-i-1]+r;n=r}return c.options.numerals.length&&(n=n.replace(/[0-9]/g,(function(e){return c.options.numerals[+e]})),o=o.replace(/[0-9]/g,(function(e){return c.options.numerals[+e]}))),(s?"-":"")+c.options.prefix+n+o+c.options.suffix},prefix:"",suffix:"",numerals:[]},i&&"object"==typeof i)for(var s in c.options)i.hasOwnProperty(s)&&null!==i[s]&&(c.options[s]=i[s]);""===c.options.separator?c.options.useGrouping=!1:c.options.separator=""+c.options.separator;for(var l=0,u=["webkit","moz","ms","o"],d=0;d<u.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[u[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[u[d]+"CancelAnimationFrame"]||window[u[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),o=Math.max(0,16-(n-l)),r=window.setTimeout((function(){e(n+o)}),o);return l=n+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),c.initialize=function(){return!(!c.initialized&&(c.error="",c.d="string"==typeof e?document.getElementById(e):e,c.d?(c.startVal=Number(t),c.endVal=Number(n),a(c.startVal)&&a(c.endVal)?(c.decimals=Math.max(0,o||0),c.dec=Math.pow(10,c.decimals),c.duration=1e3*Number(r)||2e3,c.countDown=c.startVal>c.endVal,c.frameVal=c.startVal,c.initialized=!0,0):(c.error="[CountUp] startVal ("+t+") or endVal ("+n+") is not a number",1)):(c.error="[CountUp] target is null or undefined",1)))},c.printValue=function(e){var t=c.options.formattingFn(e);"INPUT"===c.d.tagName?this.d.value=t:"text"===c.d.tagName||"tspan"===c.d.tagName?this.d.textContent=t:this.d.innerHTML=t},c.count=function(e){c.startTime||(c.startTime=e),c.timestamp=e;var t=e-c.startTime;c.remaining=c.duration-t,c.options.useEasing?c.countDown?c.frameVal=c.startVal-c.options.easingFn(t,0,c.startVal-c.endVal,c.duration):c.frameVal=c.options.easingFn(t,c.startVal,c.endVal-c.startVal,c.duration):c.countDown?c.frameVal=c.startVal-(c.startVal-c.endVal)*(t/c.duration):c.frameVal=c.startVal+(c.endVal-c.startVal)*(t/c.duration),c.countDown?c.frameVal=c.frameVal<c.endVal?c.endVal:c.frameVal:c.frameVal=c.frameVal>c.endVal?c.endVal:c.frameVal,c.frameVal=Math.round(c.frameVal*c.dec)/c.dec,c.printValue(c.frameVal),t<c.duration?c.rAF=requestAnimationFrame(c.count):c.callback&&c.callback()},c.start=function(e){c.initialize()&&(c.callback=e,c.rAF=requestAnimationFrame(c.count))},c.pauseResume=function(){c.paused?(c.paused=!1,delete c.startTime,c.duration=c.remaining,c.startVal=c.frameVal,requestAnimationFrame(c.count)):(c.paused=!0,cancelAnimationFrame(c.rAF))},c.reset=function(){c.paused=!1,delete c.startTime,c.initialized=!1,c.initialize()&&(cancelAnimationFrame(c.rAF),c.printValue(c.startVal))},c.update=function(e){if(c.initialize()){if(!a(e=Number(e)))return void(c.error="[CountUp] update() - new endVal is not a number: "+e);c.error="",e!==c.frameVal&&(cancelAnimationFrame(c.rAF),c.paused=!1,delete c.startTime,c.startVal=c.frameVal,c.endVal=e,c.countDown=c.startVal>c.endVal,c.rAF=requestAnimationFrame(c.count))}},c.initialize()&&c.printValue(c.startVal)}})?o.call(t,n,t,e):o)||(e.exports=r)},550:function(e,t,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(459)),i=o(n(359)),a=n(357),c=o(a),s=o(n(551));function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h=function(e,t){var n=t.decimal,o=t.decimals,i=t.duration,a=t.easingFn,c=t.end,s=t.formattingFn,l=t.prefix,u=t.separator,d=t.start,f=t.suffix,p=t.useEasing;return new r(e,d,c,o,i,{decimal:n,easingFn:a,formattingFn:s,separator:u,prefix:l,suffix:f,useEasing:p,useGrouping:!!u})},k=function(e){function t(){var e,n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=new Array(i),l=0;l<i;l++)a[l]=arguments[l];return o=this,r=(e=d(t)).call.apply(e,[this].concat(a)),n=!r||"object"!=typeof r&&"function"!=typeof r?p(o):r,u(p(p(n)),"createInstance",(function(){return"function"==typeof n.props.children&&s(n.containerRef.current&&(n.containerRef.current instanceof HTMLElement||n.containerRef.current instanceof SVGTextElement),'Couldn\'t find attached element to hook the CountUp instance into! Try to attach "containerRef" from the render prop to a an HTMLElement, eg. <span ref={containerRef} />.'),h(n.containerRef.current,n.props)})),u(p(p(n)),"pauseResume",(function(){var e=p(p(n)),t=e.reset,o=e.restart,r=e.update,i=n.props.onPauseResume;n.instance.pauseResume(),i({reset:t,start:o,update:r})})),u(p(p(n)),"reset",(function(){var e=p(p(n)),t=e.pauseResume,o=e.restart,r=e.update,i=n.props.onReset;n.instance.reset(),i({pauseResume:t,start:o,update:r})})),u(p(p(n)),"restart",(function(){n.reset(),n.start()})),u(p(p(n)),"start",(function(){var e=p(p(n)),t=e.pauseResume,o=e.reset,r=e.restart,i=e.update,a=n.props,c=a.delay,s=a.onEnd,l=a.onStart,u=function(){return n.instance.start((function(){return s({pauseResume:t,reset:o,start:r,update:i})}))};c>0?n.timeoutId=setTimeout(u,1e3*c):u(),l({pauseResume:t,reset:o,update:i})})),u(p(p(n)),"update",(function(e){var t=p(p(n)),o=t.pauseResume,r=t.reset,i=t.restart,a=n.props.onUpdate;n.instance.update(e),a({pauseResume:o,reset:r,start:i})})),u(p(p(n)),"containerRef",c.createRef()),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){var e=this.props,t=e.children,n=e.delay;this.instance=this.createInstance(),"function"==typeof t&&0!==n||this.start()}},{key:"shouldComponentUpdate",value:function(e){return this.props.duration!==e.duration||this.props.end!==e.end||this.props.start!==e.start||this.props.redraw}},{key:"componentDidUpdate",value:function(e){this.props.duration===e.duration&&this.props.start===e.start||(this.instance=this.createInstance(),this.start()),this.props.end!==e.end&&(this.instance.reset(),this.instance.update(this.props.end))}},{key:"componentWillUnmount",value:function(){this.timeoutId&&clearTimeout(this.timeoutId),this.instance.reset()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,o=e.style,r=this.containerRef,i=this.pauseResume,a=this.reset,s=this.restart,l=this.update;return"function"==typeof t?t({countUpRef:r,pauseResume:i,reset:a,start:s,update:l}):c.createElement("span",{className:n,ref:r,style:o})}}])&&l(n.prototype,o),r&&l(n,r),t}(a.Component);u(k,"propTypes",{decimal:i.string,decimals:i.number,delay:i.number,easingFn:i.func,end:i.number.isRequired,formattingFn:i.func,onEnd:i.func,onStart:i.func,prefix:i.string,redraw:i.bool,separator:i.string,start:i.number,suffix:i.string,style:i.object,useEasing:i.bool}),u(k,"defaultProps",{decimal:".",decimals:0,delay:null,duration:null,easingFn:null,formattingFn:null,onEnd:function(){},onPauseResume:function(){},onReset:function(){},onStart:function(){},onUpdate:function(){},prefix:"",redraw:!1,separator:"",start:0,suffix:"",style:void 0,useEasing:!0});t.default=k,t.useCountUp=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){u(e,t,n[t])}))}return e}({},k.defaultProps,e),n=t.start,o=t.formattingFn,r=m(a.useState("function"==typeof o?o(n):n),2),i=r[0],c=r[1],s=a.useRef(null),l=function(){var e=s.current;if(null!==e)return e;var n=function(){var e=h(-1,t),n=e.options.formattingFn;return e.options.formattingFn=function(){var e=n.apply(void 0,arguments);c(e)},e}();return s.current=n,n},d=function(){var e=t.onReset;l().reset(),e({pauseResume:p,start:f,update:g})},f=function e(){var n=t.onStart,o=t.onEnd;l().reset(),l().start((function(){o({pauseResume:p,reset:d,start:e,update:g})})),n({pauseResume:p,reset:d,update:g})},p=function(){var e=t.onPauseResume;l().pauseResume(),e({reset:d,start:f,update:g})},g=function(e){var n=t.onUpdate;l().update(e),n({pauseResume:p,reset:d,start:f})};return a.useEffect((function(){var e=t.delay,n=t.onStart,o=t.onEnd,r=setTimeout((function(){n({pauseResume:p,reset:d,update:g}),l().start((function(){clearTimeout(r),o({pauseResume:p,reset:d,start:f,update:g})}))}),1e3*e);return d}),[]),{countUp:i,start:f,pauseResume:p,reset:d,update:g}}},551:function(e,t,n){"use strict";var o=function(){};e.exports=o},593:function(e,t,n){"use strict";n.r(t),n.d(t,"TokenModalClass",(function(){return b})),n.d(t,"TokenModal",(function(){return v}));var o=n(357),r=n(360),i=n(552),a=n(662),c=n(772),s=n(363),l=n(663),u=n(410),d=n(3),f=n(6),p=n(15),m=n(0),h=n(75),k=n(76),g=n(7),b=function(){function e(){var e=this;this.handleResizeStop=this.handleResizeStop.bind(this),this.$tokenHeaderButton=$(".main-token-status-container"),this.initialStep=void 0,$(document).on("click",".main-token-status-container",(function(){e.$tokenHeaderButton.is(".selected")?e.render(!1):e.render(!0)})).on("click",".token-notifier-container .sign-in-button",(function(){return e.render(!1)})).on("slideMenuOpened modalOpening searchOpen",(function(){return e.render(!1)})).on("click",".token-ledger-table-container a",(function(){return e.render(!1)})).on("withinChapterLinkScroll",(function(){return e.render(!1)})).on("landing-page-appropriate-releases-initialized",(function(){void 0!==e.initialStep&&(e.render(!0),e.initialStep=void 0)})),$(window).on("resizestop",this.handleResizeStop),h.a.getTokenProductOffering().then((function(t){e.tokenProductOfferingPrice=t.price||.01})).catch((function(t){console.log("Error when getting token product offering price"),e.tokenProductOfferingPrice=.01}))}return e.prototype.initialize=function(){this.initialStep=this.getInitialTokenModalState()},e.prototype.getInitialTokenModalState=function(){var e=document.location.hash||document.location.pathname;return e.indexOf("token-ledger")>=0?c.a.ledger:e.indexOf("token-modal")>=0?c.a.showingTokenInfo:e.indexOf("token-cashout")>=0?c.a.cashout:e.indexOf("get-tokens")>=0?c.a.purchasing:void 0},e.prototype.clean=function(){r.unmountComponentAtNode(document.getElementById("full-screen-modal")),this.$tokenHeaderButton.removeClass("selected")},e.prototype.handleResizeStop=function(){var e=this;this.positionModal(),setTimeout((function(){return e.positionModal()}),100)},e.prototype.positionModal=function(){if($(document.body).is(".ReactModal__Body--open")){var e=$(".ReactModal__Overlay");if(!(e.find(".shopping-cart-modal").length>0)){var t=f.a.getNavbarHeightInPx();e.css("top",t)}}},e.prototype.show=function(){this.render(!0),this.positionModal()},e.prototype.hide=function(){this.render(!1)},e.prototype.render=function(e){var t=this;this.$tokenHeaderButton.toggleClass("selected",e),g.a.isCurrentlyLoggedIn()?r.render(o.createElement(c.b,{isShown:e,onClose:function(){return t.render(!1)},livebookBaseLink:m.a.getLivebookBaseUrl(),livevideoBaseLink:m.a.getLivevideoBaseUrl(),initialStep:this.initialStep,tokenPrice:this.tokenProductOfferingPrice||.01,topOffset:f.a.getNavbarHeightInPx(),onCashout:function(){return new Promise((function(e,t){u.a.cashout().then((function(n){n&&!1===n.success&&n.reason?t(n.reason):e(!0)})).catch((function(e){t("Error when performing cashout. Try later or contact our support: support@manning.com")}))}))},onAddTokensToCart:function(e){return t.buyTokens(e)},getCashoutPaymentTypes:function(){return new Promise((function(e,t){u.a.getTokenCashoutInfo().then((function(t){e(t&&t.paymentsInfo)})).catch((function(e){t("Error when ")}))}))},getTokenLedgerItems:function(){return u.a.getTokenLedgerItems()},getTokenState:function(){return new Promise((function(t,n){u.a.getTokenCountInfo(e).then((function(e){u.a.setTokenCountInfo(e),k.a.refreshTokenStateInToolbar(e),t(e)})).catch((function(e){n(e)}))}))}}),document.getElementById("full-screen-modal")):r.render(o.createElement(i.a,{isShown:e,title:"Tokens",onClose:function(){return t.render(!1)},topOffset:f.a.getNavbarHeightInPx()},o.createElement("p",null,"Tokens can be used to unlock parts of books, from sub-sections to chapters.",o.createElement("br",null),"Any dollar amount spent unlocking content will be deducted from the final book price.",o.createElement("br",null),"You can cash out any time, reverting tokens back to dollars."),o.createElement("p",null,o.createElement("a",{className:"sign-in-button micropurchase-sign-in",href:"javascript:void(0)"},"sign in")," and get 500 tokens for FREE!")),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfTokensNotifier=function(e,t){var n=this;void 0===t&&(t=!0),r.render(o.createElement(a.a,{isShown:t,topOffset:f.a.getNavbarHeightInPx(),showBuyTokensButton:!0,showCartButton:!0,isProductAlreadyInCart:h.a.isEbookInShoppingCart(e),productType:"book",productTitle:p.a.cleanBookTitle(e.title),isMeap:e.isMeap,onRequestBuyTokens:function(){n.renderOutOfTokensNotifier(e,!1),setTimeout((function(){n.initialStep=c.a.purchasing,n.render(!0)}),200)},onRequestCart:function(){h.a.isEbookInShoppingCart(e)||h.a.requestAddBookToCart(e),n.renderOutOfTokensNotifier(e,!1)},onClose:function(){return n.renderOutOfTokensNotifier(e,!1)}}),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfParagraphByParagraphUnlocks=function(e,t){var n=this;r.render(o.createElement(i.a,{isShown:e,title:"Out of individual paragraph tokens",onClose:function(){return n.renderOutOfParagraphByParagraphUnlocks(!1)},topOffset:f.a.getNavbarHeightInPx()},o.createElement("p",null,t)),document.getElementById("full-screen-modal"))},e.prototype.renderLicenceCreatedModal=function(e){var t=this;void 0===e&&(e=!0),r.render(o.createElement(i.a,{isShown:e,title:"you've spent enough tokens on this book to unlock the rest of it for free",theme:s.a.green,topOffset:f.a.getNavbarHeightInPx(),onClose:function(){return t.renderLicenceCreatedModal(!1)}},o.createElement("em",null,"the full eBook is in your ",o.createElement("a",{href:""+m.a.getMarketplaceUrl("dashboard"),style:{color:"white"}},"library")," for you to download or save at your leisure")),document.getElementById("full-screen-modal"))},e.prototype.renderUpsellModal=function(e,t,n,i){var a=this;void 0===e&&(e=!0),r.render(o.createElement(l.a,{isShown:e,spentTokenAmount:n,spentDollarAmount:i,productTitle:p.a.cleanBookTitle(t&&t.title),onBuy:function(){h.a.isEbookInShoppingCart(t)?h.a.requestMenuOpen():h.a.requestAddBookToCart(t)},topOffset:f.a.getNavbarHeightInPx(),onClose:function(){return a.renderUpsellModal(!1)}}),document.getElementById("full-screen-modal"))},e.prototype.buyTokens=function(e){h.a.addTokensToCart(e),d.a.setTimeout((function(){return h.a.requestMenuOpen()}),150)},e}(),v=new b},957:function(e,t,n){var o=n(958);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(98)(o,r);o.locals&&(e.exports=o.locals)},958:function(e,t,n){(e.exports=n(97)(!1)).push([e.i,".unlock-confirm-modal{font-family:Lato}.unlock-confirm-modal h3{font-weight:300}@media screen and (max-width: 650px){.unlock-confirm-root{font-size:80%}}.unlock-confirm-root .unlock-confirm-deemphasized-label{font-weight:300}.unlock-confirm-root svg{width:20px;height:20px;display:inline-block;margin-left:-0.25em}.unlock-confirm-root .unlock-confirm-price-label{width:40px;display:inline-block}.unlock-confirm-root .unlock-confirm-price-container{display:flex;justify-content:space-between;width:60px;flex-grow:0;flex-shrink:0;text-align:right;user-select:none;padding-right:0;font-weight:600;margin-left:1em}.unlock-confirm-root .unlock-confirm-option-row{display:flex;align-items:center;margin-bottom:0.75em}.unlock-confirm-root .unlock-confirm-option-row:last-of-type{margin-bottom:0}.unlock-confirm-root .unlock-confirm-select-box{background-color:#fecb2f;padding:0.75em 1em;margin:0;cursor:pointer;flex-grow:1}.unlock-confirm-root .unlock-confirm-select-box:hover{background-color:#fed862;color:#997a00}.unlock-confirm-root .unlock-confirm-select-box:active{background-color:#fed148}.unlock-confirm-root .unlock-confirm-select-box:not(.unlock-confirm-box){display:flex;align-items:center;justify-content:space-between}.unlock-confirm-root .unlock-confirm-action-row{margin-top:0.75em}.unlock-confirm-root .unlock-confirm-action-row .unlock-confirm-select-box{display:block}.unlock-confirm-root .unlock-confirm-action-container{background-color:#3C67A2;color:white;cursor:pointer}.unlock-confirm-root .unlock-confirm-action-container:hover{background-color:#5280bf;color:white}.unlock-confirm-root .unlock-confirm-action-container em{font-weight:300}.unlock-confirm-root .unlock-confirm-action-container .unlock-confirm-discount-label{color:#779bcd}.unlock-confirm-root .unlock-confirm-action-container .unlock-confirm-discount-label strong{color:white}.unlock-confirm-root .unlock-confirm-action-container.product-in-cart{background-color:#67a73d}.unlock-confirm-root .unlock-confirm-action-container.product-in-cart:hover{background-color:#80c156}.unlock-confirm-root .unlock-confirm-action-container.product-in-cart .unlock-confirm-discount-label{color:#9ccf7b}.unlock-confirm-root .unlock-confirm-box.unlock-confirm-select-box{text-align:right}.unlock-confirm-root .unlock-confirm-box.unlock-confirm-select-box em{margin:0 0.25em}.unlock-confirm-root .unlock-confirm-box.unlock-confirm-select-box .unlock-confirm-price-label{width:auto;margin-left:0.25em}.unlock-confirm-root .unlock-confirm-back-container{margin-right:0.75em;padding:0.4em 1em;font-size:150%;align-self:stretch;display:flex;cursor:pointer;user-select:none;background-color:#ececec}.unlock-confirm-root .unlock-confirm-back-container i{align-self:center}.unlock-confirm-root .unlock-confirm-back-container:hover{background-color:#dfdfdf}.unlock-confirm-root .unlock-confirm-back-container:active{background-color:#d3d3d3}.unlock-confirm-root .unlock-confirm-discount-container{font-size:80%;align-self:flex-end;margin-right:0.1em}.unlock-confirm-root .unlock-confirm-discount-container i{vertical-align:middle}.unlock-confirm-root .unlock-confirm-discount-container>*{margin:0.2em}.unlock-confirm-root .unlock-confirm-action-price-container{white-space:pre;float:right}.unlock-confirm-root .unlock-confirm-action-price-container .unlock-confirm-price-label{width:auto}.unlock-confirm-root .unlock-confirm-type-container svg{margin-left:0;position:relative;top:2px}\n",""])},959:function(e,t,n){var o=n(960);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(98)(o,r);o.locals&&(e.exports=o.locals)},960:function(e,t,n){(e.exports=n(97)(!1)).push([e.i,".token-meap-notification-modal label{color:white}.token-meap-notification-modal input[type='checkbox']{vertical-align:middle;margin:0 0.5rem 0 0}@media screen and (max-width: 600px){.token-meap-notification-modal{font-size:90%}}\n",""])}}]);
//# sourceMappingURL=unlockModal.chunk.js.map?9d8ad9e39c1226bf79f9