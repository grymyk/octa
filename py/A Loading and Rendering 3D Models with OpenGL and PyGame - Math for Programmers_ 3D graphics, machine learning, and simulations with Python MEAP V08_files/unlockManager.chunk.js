(window.webpackJsonp=window.webpackJsonp||[]).push([[36,26,38],{344:function(e,n,t){"use strict";t.r(n),t.d(n,"UnlockText",(function(){return h}));var o=t(15),r=t(3),a=t(16),i=t(1),s=t(4),u=t(17),c=t(129),l=t(76),d=t(25),f=$(document),p=i.b.isTouchDevice(),h=new(function(){function e(){var e=this;this.handleUnlockSuccess=this.handleUnlockSuccess.bind(this),this.handleUnlockHeadingClick=this.handleUnlockHeadingClick.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleHeadingMouseEnter=this.handleHeadingMouseEnter.bind(this),f.on("freePreviewModeActivated",(function(){e.hideHeadingLocks()})),f.on("freePreviewModeDeactivated",(function(){e.showHeadingLocks()})),f.on("pointingLinkOpened",(function(n,t,o){o&&e.hideHeadingLocks()}))}return e.prototype.initialize=function(e,n){var t=this;null!=n&&n.isOpen||null==n.bookElementPriceInfo||e&&(u.a.isUnlockingWholeContentThroughPointingLink||(this.book=e,this.bookElement=n,$(document.body).addClass("unlock-supported"),this.$headings=o.a.getHeadings(),f.on("unlockSuccess",this.handleUnlockSuccess),this.book&&r.a.setTimeout((function(){t.$headings.each((function(e,n){var r=$(n),a=o.a.getHeadingSectionCost(t.bookElement.bookElementPriceInfo,r,t.$headings);a>0&&0==r.find(".scrambled-notifier").length&&r.append(t.generateScrambledParagraphNotifierHTML(a,!0,r.text().trim()))})),u.a.isFreePreviewActive()&&t.hideHeadingLocks(),p||t.$headings.on("mouseenter",t.handleHeadingMouseEnter)}),10),this.book.isParagraphByParagraphUnlockDisabled||(f.on("mouseenter",".readable-text.scrambled",this.handleMouseEnter),f.on("mouseleave",".readable-text.scrambled",this.handleMouseLeave),$(".readable-text.scrambled").on("click",this.handleScrambledTextClick)),f.on("click",".scrambled-notifier",this.handleScrambledTextClick)))},e.prototype.clean=function(){this.$headings=null,f.off("unlockSuccess",this.handleUnlockSuccess),f.off("click",".scrambled-notifier",this.handleScrambledTextClick),this.unsubscribeParagraphUnlockEvents(),$(".scrambled").off(),$(document.body).removeClass("unlock-supported")},e.prototype.disableParagraphByParagraphUnlock=function(){this.unsubscribeParagraphUnlockEvents()},e.prototype.getParagraphsPrice=function(e){var n=this;if(null!=e&&0!=e.length&&null!=this.bookElement&&null!=this.bookElement.bookElementPriceInfo){var t=0;return e.forEach((function(e){return t+=n.getParagraphPrice(e)})),Math.max(t,0)}},e.prototype.getParagraphPrice=function(e){if(null==this.bookElement||null==this.bookElement.bookElementPriceInfo)return 0;if(!e||!e.length)return 0;var n=(this.bookElement.wordCount||0)-(this.bookElement.freeWordCount||0);if(!(n<=0)){var t=this.bookElement.bookElementPriceInfo.fullTokenPrice;if(!(t<=0)){var o=e.text();return e.find(".scrambled-notifier").length&&(o=o.replace(e.find(".scrambled-notifier").text(),"")),Math.max(Math.ceil(s.a.getNumberOfWords(o)/n*1.2*t),0)}}},e.prototype.showHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","flex")},e.prototype.hideHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","none")},e.prototype.unsubscribeParagraphUnlockEvents=function(){f.off("mouseenter",".readable-text.scrambled",this.handleMouseEnter),f.off("mouseleave",".readable-text.scrambled",this.handleMouseLeave),f.off("click",".scrambled-notifier",this.handleScrambledTextClick)},e.prototype.handleHeadingMouseEnter=function(e){$(e.currentTarget).find(".heading-scrambled-notifier").removeClass("heading-scrambled-notifier-hidden")},e.prototype.handleMouseEnter=function(e){var n=$(e.currentTarget);if(p||$(".heading-scrambled-notifier").addClass("heading-scrambled-notifier-hidden"),!n.is(".unscrambled, .unscrambling")&&n.is(".scrambled")&&!u.a.isFreePreviewActive())if(n.is("li")){var t=o.a.expandListOfScrambledParagraphsIfNecessary([n]);t.length>1?this.addScrambleParagraphNotifierHtml(n.parent()):this.addScrambleParagraphNotifierHtml(n),t.forEach((function(e){return e.addClass("unscramble-target")}))}else this.addScrambleParagraphNotifierHtml(n),n.addClass("unscramble-target")},e.prototype.handleMouseLeave=function(e){var n=$(e.currentTarget);n.find(".scrambled-notifier").remove(),n.is("li")&&n.parent().find(".scrambled-notifier").remove(),$(".unscramble-target").removeClass("unscramble-target")},e.prototype.addScrambleParagraphNotifierHtml=function(e){if(e&&e.length&&0==e.find(".scrambled-notifier").length){var n=0;if(e.is("ul, ol")){var t=[];e.children().each((function(e,n){t.push($(n))})),n=this.getParagraphsPrice(t)}else n=this.getParagraphPrice(e);n>0&&e.append(this.generateScrambledParagraphNotifierHTML(n))}},e.prototype.handleUnlockSuccess=function(e,n){var t=this;n!=c.a.FreePreview&&"FreePreview"!=n&&r.a.setTimeout((function(){t.book&&t.bookElement&&t.book.shortName&&t.bookElement.shortName&&d.a.getCompleteBookElementPriceInfo(t.book.shortName,t.bookElement.shortName,t.bookElement.meapVersion).then((function(e){null!=e&&0!=e.tokenPrice&&(t.bookElement.bookElementPriceInfo=e,t.$headings.each((function(e,n){var r=$(n),a=o.a.getHeadingSectionCost(t.bookElement.bookElementPriceInfo,r,t.$headings);0!=a?r.find(".price-container").text(a):r.find(".scrambled-notifier").remove()})))})).catch((function(e){console.log("Cannot get book element price info")}))}),50)},e.prototype.handleUnlockHeadingClick=function(e){var n=$("#"+$(e.currentTarget).attr("data-heading-id"));l.a.showModalForCurrentBookElementPurchases(n)},e.prototype.generateScrambledParagraphNotifierHTML=function(e,n,t){void 0===n&&(n=!1),void 0===t&&(t="");var o="";o=n?a.a.isChapterOrAppendix(t)?"unlock whole chapter":"unlock whole section":"unlock this paragraph";var r=i.b.isTouchDevice()?"tap":"click";return n?'<div class="scrambled-notifier heading-scrambled-notifier '+(p?"":"heading-scrambled-notifier-hidden")+' unlock-notifier" title="'+o+'">\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+"</span>\n                        </div>\n                    </div>":'<div class="scrambled-notifier paragraph-scrambled-notifier unlock-notifier '+(e>9?"contains-double-digit-tokens":"")+'" title="'+o+'">\n                        <span class="scramble-message-container show-medium-up">'+r+' to unlock! </span>\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+'</span>\n                        </div>\n                        <span class="scrambled-arrow-container"></span>\n                    </div>'},e.prototype.getRelevantScrambledParagraph=function(e){if(e)try{var n=$(e).closest(".readable-text");if(n.is(".scrambled")&&!n.is("li"))n[0];else{var t=parseInt(n.attr("refid"));if(Number.isNaN(t))return null;for(var o=t+1;o<t+10;o++){if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}for(o=t-1;o>t-10;o--){var r;if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}}}catch(e){}return null},e.prototype.handleScrambledTextClick=function(e){if(!$(e.target).is("a")&&!$(document.body).is(".free-preview-mode")){var n=$(e.currentTarget);n.is(".scrambled")?l.a.showModalForCurrentBookElementPurchases(null,o.a.expandListOfScrambledParagraphsIfNecessary([n])):n.is(".scrambled-notifier.heading-scrambled-notifier")&&l.a.showModalForCurrentBookElementPurchases(n.closest(".readable-text"))}},e}())},345:function(e,n,t){"use strict";t.r(n);var o,r=t(357),a=t(360),i=(o=function(e,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)},function(e,n){function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),s=function(e){function n(n){var t=e.call(this,n||"Promise was canceled")||this;return t.name="CancelError",t}return i(n,e),Object.defineProperty(n.prototype,"isCanceled",{get:function(){return!0},enumerable:!0,configurable:!0}),n}(Error),u=function(){function e(e){var n=this;this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._promise=new Promise((function(t,o){return n._reject=o,e((function(e){n._isPending=!1,t(e)}),(function(e){n._isPending=!1,o(e)}),(function(e){n._cancelHandlers.push(e)}))}))}return e.fn=function(n){return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return new e((function(e,o,r){t.push(r),n.apply(void 0,t).then(e,o)}))}},e.prototype.then=function(e,n){return this._promise.then(e,n)},e.prototype.catch=function(e){return this._promise.catch(e)},e.prototype.finally=function(e){return this._promise.finally(e)},e.prototype.cancel=function(e){if(this._isPending&&!this._isCanceled){if(this._cancelHandlers.length>0)try{for(var n=0,t=this._cancelHandlers;n<t.length;n++){(0,t[n])()}}catch(e){this._reject(e)}this._isCanceled=!0,this._reject(new s(e))}},Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),e}(),c=u;Object.setPrototypeOf(u.prototype,Promise.prototype);var l=t(550),d=t.n(l),f=t(0),p=t(9),h=t(3),m=t(410),g=t(57),k=t(15),b=t(128),v=t(593),y=t(344),T=t(4),P=t(29),w=t(75),C=t(129),I=function(){function e(e){this.$readableTexts=e,C.b.markParagraphsForUnscrambling(e)}return e.prototype.startUnlockAnimation=function(){this.fadeOutAllText()},e.prototype.revertAnimation=function(){this.fadeInAllText()},e.prototype.fadeOutAllText=function(){var e=this,n=$($.map(this.$readableTexts,(function(e){return e.get()})));n.velocity({opacity:0},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||n.velocity({opacity:1},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||e.fadeOutAllText()}})}})},e.prototype.fadeInAllText=function(){var e=$($.map(this.$readableTexts,(function(e){return e.get()})));e.velocity("stop"),e.velocity({opacity:1},{duration:250})},e.prototype.insertUnscrambledContent=function(e){for(var n=function(n){var o=t.$readableTexts[n],r=o.attr("refid"),a=e.find((function(e){return e.paragraphID==r}));a&&(o.html(a.content),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.find(".scrambled-notifier").remove(),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.attr("data-original-html",""))},t=this,o=0;o<this.$readableTexts.length;o++)n(o)},e.prototype.unlockWithAnimations=function(e){this.fadeInAllText(),e&&e()},e}(),E=t(14),O=t(81),S=t(7);t.d(n,"UnlockContentManager",(function(){return x}));var M=$(document),x=new(function(){function e(){var e=this;this.$unscrambleInfoModal=$("#unscramble-info-modal"),0==this.$unscrambleInfoModal.length&&($(document.body).append(A),this.$unscrambleInfoModal=$("#unscramble-info-modal")),h.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".add-to-cart-button",(function(){return e.addCurrentBookToCart()})),h.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".view-in-cart-button",(function(){e.hideOutOfTokensModal(),setTimeout((function(){return w.a.requestMenuOpen()}),300)})),h.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".buy-tokens-button",(function(){e.hideOutOfTokensModal()})),M.on("shoppingCartItemsChanged",(function(){return e.updatePurchaseButtons()}))}return e.prototype.initialize=function(e,n){this.book=e,this.bookElement=n,this.fetchAndDisplayLatestTokenInfo()},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.fetchAndDisplayLatestTokenInfo=function(e){var n=this;void 0===e&&(e=!1),S.a.isCurrentlyLoggedIn()?m.a.getTokenCountInfo(e).then((function(e){n.refreshTokenStateInToolbar(e)})).catch((function(e){n.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})})):this.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})},e.prototype.tryToSearchUnlockFragmentInCurrentBookElement=function(e){this.unlockFragments(this.book,this.bookElement,C.a.Search,"",e)},e.prototype.tryToUnlockTocBookElement=function(e,n,t){var o=this;S.a.isLoggedIn().then((function(r){r.loggedIn?o.hasEnoughTokens(t,r.userDetails&&r.userDetails.tokenInfo)?(g.a.showTemporaryNotification("Unlocking content ..."),o.getUnlockTocBookElementPromise(e,n).then((function(e){M.trigger("unlockSuccess",[C.a.BookElement]),g.a.showTemporaryNotification("Unlock success. Loading "+n+"."),h.a.setTimeout((function(){b.a.openLink(b.a.formLinkFromBookSlugAndBookElementShortName(o.book.slug,n)),f.a.reloadPage()}),2e3)})).catch((function(e){M.trigger("unlockFailure",[C.a.BookElement,[]]),g.a.showTemporaryNotification("Error unlocking "+n+". Try later.")}))):o.showOutOfTokensModal():o.showLoginModal("Want to see more? Just sign in and use tokens to unlock this content.")}))},e.prototype.hasEnoughTokens=function(e,n){return null!=n&&this.getTotalNumberOfTokens(n)>=e},e.prototype.unlockFragments=function(e,n,t,o,r,a,i,s){var u=this;return new c((function(c,l,d){S.a.isLoggedIn().then((function(f){var p=t==C.a.Search,h=t==C.a.FreePreview;if(f.loggedIn||h){var k=r.map((function(e){return e.attr("id")})),b=i||u.getTokenCost(r);u.getTotalNumberOfTokens(f.userDetails&&f.userDetails.tokenInfo);if(h||p||u.hasEnoughTokens(b,f.userDetails&&f.userDetails.tokenInfo)){var T=u.unlockContent(n,t,o,k,s).then((function(e){C.b.replaceEncryptedContent($("body"),e.ownedContent||e.unlockedParagraphs),M.trigger("paragraphsUnlocked",[k]),p||h||null!=e.tokenInfo&&(m.a.setTokenCountInfo(e.tokenInfo),u.refreshTokenStateInToolbar(e.tokenInfo)),M.trigger("unlockSuccess",[C.a[t]]),c(e),setTimeout((function(){e.licenseCreated?v.TokenModal.renderLicenceCreatedModal():e.productTokenInfo&&e.productTokenInfo.spentAmountInDollars&&e.productTokenInfo.spentAmountInTokens&&w.a.getBookPrice(u.book).then((function(n){e.productTokenInfo.spentAmountInDollars>=.25*n&&v.TokenModal.renderUpsellModal(!0,u.book,e.productTokenInfo.spentAmountInTokens,e.productTokenInfo.spentAmountInDollars)}))}),100)})).catch((function(n){var o="Error when unlocking content";p?o="Unfortunatly, you've exceeded the search unscrambling limit for this book. Try again tomorrow.":h&&(o="Unfortunatly, you've exceeded the free preview limit for this book. Try again tomorrow."),null!=n.remainingPreviewDuration&&n.remainingPreviewDuration<0||(g.a.showTemporaryNotification(o),M.trigger("unlockFailure",[C.a[t],k]),l(n),n&&n.outOfSingleParagraphUnlocks&&(M.trigger("outOfParagraphByParagraphUnlocks"),v.TokenModal.renderOutOfParagraphByParagraphUnlocks(!0,n.reason),y.UnlockText.disableParagraphByParagraphUnlock(),e&&(e.isParagraphByParagraphUnlockDisabled=!0)))}));d((function(){return T&&T.cancel()}))}else u.showOutOfTokensModal()}else u.showLoginModal("Want to see more? Just sign in"+(t==C.a.Search?" and the paragraph will unlock for you.":" and use tokens to unlock this content.")),u.setOriginalLinkLocation(a)}))}))},e.prototype.tryToUnlockPointedParagraph=function(e,n,t,o){var r=this;if(e&&n&&t&&!(t.length<2)){var a=C.b.getDataFromPointingLink(e,n,t);if(null!=a){for(var i=[],s=a.startParagraphId;s<=a.endParagraphId;s++){var u=document.getElementById(s);u&&i.push($(u))}var c=C.b.isEncompassingWholeContent(a.startParagraphId,a.endParagraphId);c||i.forEach((function(e){return e.addClass("paragraph-selected")}));var l=i.filter((function(e){return e.is(".scrambled")}));a.paragraphsToUnlock=l.map((function(e){return e.attr("id")})).join(","),M.trigger("pointingLinkOpened",[a.pointingLinkId,c]),l.length?S.a.isLoggedIn().then((function(n){if(n.loggedIn)if(a.isUserEditorLink)r.unlockPointedParagraphs(e,l,a.startParagraphId,a.endParagraphId,a);else{var t=Math.max(r.getTokenCost(l),1);if(!(r.getTotalNumberOfTokens(n.userDetails&&n.userDetails.tokenInfo)>=t))return void g.a.showTemporaryNotification("You don't have enough tokens to unlock the whole pointed content");g.a.showNotificationModal("Confirm","Spend "+t+" "+(t>1?"tokens":"token")+" to unlock this content?",!0,(function(){return r.unlockPointedParagraphs(e,l,a.startParagraphId,a.endParagraphId,a)}))}else r.showLoginModal("Want to see more? Just sign in."),r.setOriginalLinkLocation(o)})):a.pointingLinkId&&this.reportPointingLinkUsed(a.pointingLinkId)}}},e.prototype.unlockPointedParagraphs=function(e,n,t,o,r){var a=this,i=new I(n);i.startUnlockAnimation(),f.a.getFromOurBackend(f.a.getAbsoluteUrl("api/pointing/getPointedContent"),(function(e){i.insertUnscrambledContent(e.paragraphInfos||[]),i.unlockWithAnimations(),M.trigger("unlockSuccess",[C.a[C.a.Point]]),null!=e.tokenInfo&&(m.a.setTokenCountInfo(e.tokenInfo),a.refreshTokenStateInToolbar(e.tokenInfo))}),(function(e){g.a.showNotification("Error when trying to unlock. Please try later."),M.trigger("unlockFailure",[!1,!0,[t,o]]),i.revertAnimation()}),r)},e.prototype.reportPointingLinkUsed=function(e){f.a.getFromOurBackend(f.a.getAbsoluteUrl("api/pointing/reportSimpleUse"),(function(e){}),(function(e){}),{pointingLinkId:e})},e.prototype.unlockContent=function(e,n,t,o,r){var a=this;return void 0===r&&(r={}),new c((function(i,s,u){var c=new I(o.map((function(e){return $(document.getElementById(e))})));c.startUnlockAnimation(),Promise.all([a.getUnlockBookElementContentPromise(e,n,t,o,r),T.a.getTimeoutPromise(500)]).then((function(e){var t=e[0];if(!t.success)return null!=c&&c.revertAnimation(),void s(t);t.tokenInfo&&a.refreshTokenStateInToolbar(t.tokenInfo),n==C.a.BookElement&&$(".heading-scrambled-notifier").remove(),c.insertUnscrambledContent(t.ownedContent||t.unlockedParagraphs),c.unlockWithAnimations((function(){return i(t)}))})).catch((function(e){null!=c&&c.revertAnimation(),s(e)}))}))},e.prototype.getUnlockTocBookElementPromise=function(e,n){var t=this;return new Promise((function(o,r){f.a.postToOurBackend(f.a.getAbsoluteUrl("api/userBook/unlockTocBookElement"),(function(e){return o(e)}),(function(e){return r(e)}),{bookShortName:e.shortName,bookElementShortName:n,meapVersion:t.bookElement.meapVersion})}))},e.prototype.getUnlockBookElementContentPromise=function(e,n,t,o,r){var a=this;return new c((function(i,s,u){O.a.getAbTestVariant().then((function(u){var c=a.getUnlockBookElementContentApiSendData(e,n,t,o,r);c.durationVariant=u,f.a.postToOurBackend(f.a.getAbsoluteUrl("api/userBook/unlockBookElementContent"),(function(n){n&&(n.ownedContent?a.fixOwnedContentImages(n.ownedContent):n.unlockedParagraphs&&a.fixOwnedContentImages(n.unlockedParagraphs),n.productTokenInfo&&e.book&&(e.book.spendingInfo={spentTokenAmount:n.productTokenInfo.spentAmountInTokens,spentDollarAmount:n.productTokenInfo.spentAmountInDollars},M.trigger("bookSpendingInfoArrived"))),i(n)}),(function(e){return s(e)}),c)}))}))},e.prototype.getUnlockBookElementContentApiSendData=function(e,n,t,o,r){var a={bookShortName:e.book.shortName,bookElementShortName:e.shortName,paragraphIDs:(o||[]).join(","),meapVersion:e.meapVersion,isSearch:n==C.a.Search,isFreePreview:n==C.a.FreePreview,logTimings:!!E.a.getItem("logTimings")};switch(n){case C.a.BookElement:delete a.paragraphIDs;break;case C.a.Section:a.sectionShortName=t;break;case C.a.Subsection:a.subsectionShortName=t}try{if(r&&r instanceof Object)for(var i in r)a[i]=r[i]}catch(e){console.log("Error when adding additional parameters when unlocking")}return a},e.prototype.fixOwnedContentImages=function(e){if(!e)return e;for(var n=0;n<e.length;n++)e[n].content=e[n].content.replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,f.a.getAwsPublic())},e.prototype.addCurrentBookToCart=function(){w.a.requestAddBookToCart(this.book)},e.prototype.updatePurchaseButtons=function(){this.book?(this.$unscrambleInfoModal.find(".add-to-cart-button").toggleClass("hidden",this.book.userOwnsBook||w.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".view-in-cart-button").toggleClass("hidden",!w.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".buy-tokens-button").toggleClass("hidden",!0)):this.$unscrambleInfoModal.find(".add-to-cart-button, .buy-tokens-button, .view-in-cart-button").addClass("hidden")},e.prototype.refreshTokenStateInToolbar=function(e){var n=$(".token-amount-container"),t=parseInt(n.first().text().replace(",","")||"0");Number.isNaN(t)&&(t=0);var o=(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0);if(0==o||0==t||0==n.filter(":visible").length)n.each((function(e,n){a.unmountComponentAtNode(n)})),n.html(""+T.a.numberWithCommas(o||""));else try{a.render(r.createElement(d.a,{start:t,end:o,duration:1.5,separator:",",onStart:function(){t!=o&&n.addClass("counting glow-text")},onEnd:function(){n.removeClass("counting glow-text")}}),n.filter(":visible")[0])}catch(e){n.each((function(e,n){a.unmountComponentAtNode(n)})),n.html(""+(o||""))}},e.prototype.showLoginModal=function(e){void 0===e&&(e=""),P.a.requestOpenModal("signin",e,"microtransactions")},e.prototype.showOutOfTokensModal=function(){v.TokenModal.renderOutOfTokensNotifier(this.book),this.updatePurchaseButtons()},e.prototype.hideOutOfTokensModal=function(){p.a.hideFoundationModal(this.$unscrambleInfoModal)},e.prototype.getTotalNumberOfTokens=function(e){return null==e?0:(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0)},e.prototype.getTokenCost=function(e){return y.UnlockText.getParagraphsPrice(k.a.expandListOfScrambledParagraphsIfNecessary(e.filter((function(e){return e.is(".scrambled")}))))},e.prototype.setOriginalLinkLocation=function(e){e&&h.a.setTimeout((function(){e&&history.pushState({},document.title,e)}),400)},e}()),A='<div id="unscramble-info-modal" class="reveal-modal" data-reveal>\n    <span class="close-reveal-modal">&times;</span>\n    <div class="row">\n        <div class="small-12 columns unscramble-info-modal-content-container">\n            {{{UNSCRAMBLE_INFO_CONTENT}}}\n        </div>\n    </div>\n</div>'},410:function(e,n,t){"use strict";var o=t(0),r=t(22),a=t(76),i=t(4),s=t(7),u=t(1),c=t(128),l=function(){function e(){}return e.prototype.getTokenCountInfo=function(e){var n=this;return void 0===e&&(e=!1),e||null==this.currentTokenCountInfo?e||null==this.currentTokenCountInfoPromise?this.currentTokenCountInfoPromise=new Promise((function(t,o){s.a.isLoggedIn(e).then((function(e){e.loggedIn&&e.userDetails.tokenInfo?(n.currentTokenCountInfo=e.userDetails.tokenInfo,t(e.userDetails.tokenInfo)):(n.currentTokenCountInfoPromise=null,o("No token count info"))})).catch((function(e){return o(e)}))})):this.currentTokenCountInfoPromise:Promise.resolve(this.currentTokenCountInfo)},e.prototype.setTokenCountInfo=function(e){this.currentTokenCountInfo=e,r.a.setTokenInfo(e)},e.prototype.getTokenLedgerItems=function(e){var n=this;return void 0===e&&(e=!1),u.b.isApp()&&!u.b.isConnected()?Promise.resolve([]):s.a.isCurrentlyLoggedIn()?e&&this.lastTokenLedger?Promise.resolve(this.lastTokenLedger):new Promise((function(e,t){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getTokenLedger"),(function(t){var o=t.map((function(e){return{date:i.a.getDateFromString(e.date),quantity:e.quantity,description:e.description,notes:e.notes,link:c.a.adjustBookLink(e.link),isFreeTokensRedemption:"COMPED"==e.type}}));n.lastTokenLedger=o,e(o)}),(function(e){t("Error getting token ledger")}))})):Promise.resolve([])},e.prototype.getTokenCashoutInfo=function(){var e=this;return new Promise((function(n,t){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getCashoutInfo"),(function(t){t&&t.tokenCount&&(e.setTokenCountInfo(t.tokenCount),a.a.refreshTokenStateInToolbar(t.tokenCount)),n(t)}),(function(e){return t("Error getting token ledger")}))}))},e.prototype.cashout=function(){var e=this;return new Promise((function(n,t){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/cashout"),(function(t){t&&t.tokenCount&&(e.setTokenCountInfo(t.tokenCount),a.a.refreshTokenStateInToolbar(t.tokenCount)),n(t)}),(function(e){return t("Error performing token cashout")}))}))},e}();n.a=new l},459:function(e,n,t){var o,r;void 0===(r="function"==typeof(o=function(e,n,t){return function(e,n,t,o,r,a){function i(e){return"number"==typeof e&&!isNaN(e)}var s=this;if(s.version=function(){return"1.9.3"},s.options={useEasing:!0,useGrouping:!0,separator:",",decimal:".",easingFn:function(e,n,t,o){return t*(1-Math.pow(2,-10*e/o))*1024/1023+n},formattingFn:function(e){var n,t,o,r,a,i,u=e<0;if(e=Math.abs(e).toFixed(s.decimals),t=(n=(e+="").split("."))[0],o=n.length>1?s.options.decimal+n[1]:"",s.options.useGrouping){for(r="",a=0,i=t.length;a<i;++a)0!==a&&a%3==0&&(r=s.options.separator+r),r=t[i-a-1]+r;t=r}return s.options.numerals.length&&(t=t.replace(/[0-9]/g,(function(e){return s.options.numerals[+e]})),o=o.replace(/[0-9]/g,(function(e){return s.options.numerals[+e]}))),(u?"-":"")+s.options.prefix+t+o+s.options.suffix},prefix:"",suffix:"",numerals:[]},a&&"object"==typeof a)for(var u in s.options)a.hasOwnProperty(u)&&null!==a[u]&&(s.options[u]=a[u]);""===s.options.separator?s.options.useGrouping=!1:s.options.separator=""+s.options.separator;for(var c=0,l=["webkit","moz","ms","o"],d=0;d<l.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[l[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[l[d]+"CancelAnimationFrame"]||window[l[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var t=(new Date).getTime(),o=Math.max(0,16-(t-c)),r=window.setTimeout((function(){e(t+o)}),o);return c=t+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),s.initialize=function(){return!(!s.initialized&&(s.error="",s.d="string"==typeof e?document.getElementById(e):e,s.d?(s.startVal=Number(n),s.endVal=Number(t),i(s.startVal)&&i(s.endVal)?(s.decimals=Math.max(0,o||0),s.dec=Math.pow(10,s.decimals),s.duration=1e3*Number(r)||2e3,s.countDown=s.startVal>s.endVal,s.frameVal=s.startVal,s.initialized=!0,0):(s.error="[CountUp] startVal ("+n+") or endVal ("+t+") is not a number",1)):(s.error="[CountUp] target is null or undefined",1)))},s.printValue=function(e){var n=s.options.formattingFn(e);"INPUT"===s.d.tagName?this.d.value=n:"text"===s.d.tagName||"tspan"===s.d.tagName?this.d.textContent=n:this.d.innerHTML=n},s.count=function(e){s.startTime||(s.startTime=e),s.timestamp=e;var n=e-s.startTime;s.remaining=s.duration-n,s.options.useEasing?s.countDown?s.frameVal=s.startVal-s.options.easingFn(n,0,s.startVal-s.endVal,s.duration):s.frameVal=s.options.easingFn(n,s.startVal,s.endVal-s.startVal,s.duration):s.countDown?s.frameVal=s.startVal-(s.startVal-s.endVal)*(n/s.duration):s.frameVal=s.startVal+(s.endVal-s.startVal)*(n/s.duration),s.countDown?s.frameVal=s.frameVal<s.endVal?s.endVal:s.frameVal:s.frameVal=s.frameVal>s.endVal?s.endVal:s.frameVal,s.frameVal=Math.round(s.frameVal*s.dec)/s.dec,s.printValue(s.frameVal),n<s.duration?s.rAF=requestAnimationFrame(s.count):s.callback&&s.callback()},s.start=function(e){s.initialize()&&(s.callback=e,s.rAF=requestAnimationFrame(s.count))},s.pauseResume=function(){s.paused?(s.paused=!1,delete s.startTime,s.duration=s.remaining,s.startVal=s.frameVal,requestAnimationFrame(s.count)):(s.paused=!0,cancelAnimationFrame(s.rAF))},s.reset=function(){s.paused=!1,delete s.startTime,s.initialized=!1,s.initialize()&&(cancelAnimationFrame(s.rAF),s.printValue(s.startVal))},s.update=function(e){if(s.initialize()){if(!i(e=Number(e)))return void(s.error="[CountUp] update() - new endVal is not a number: "+e);s.error="",e!==s.frameVal&&(cancelAnimationFrame(s.rAF),s.paused=!1,delete s.startTime,s.startVal=s.frameVal,s.endVal=e,s.countDown=s.startVal>s.endVal,s.rAF=requestAnimationFrame(s.count))}},s.initialize()&&s.printValue(s.startVal)}})?o.call(n,t,n,e):o)||(e.exports=r)},550:function(e,n,t){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var r=o(t(459)),a=o(t(359)),i=t(357),s=o(i),u=o(t(551));function c(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,n){return(f=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(t.push(i.value),!n||t.length!==n);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var m=function(e,n){var t=n.decimal,o=n.decimals,a=n.duration,i=n.easingFn,s=n.end,u=n.formattingFn,c=n.prefix,l=n.separator,d=n.start,f=n.suffix,p=n.useEasing;return new r(e,d,s,o,a,{decimal:t,easingFn:i,formattingFn:u,separator:l,prefix:c,suffix:f,useEasing:p,useGrouping:!!l})},g=function(e){function n(){var e,t,o,r;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return o=this,r=(e=d(n)).call.apply(e,[this].concat(i)),t=!r||"object"!=typeof r&&"function"!=typeof r?p(o):r,l(p(p(t)),"createInstance",(function(){return"function"==typeof t.props.children&&u(t.containerRef.current&&(t.containerRef.current instanceof HTMLElement||t.containerRef.current instanceof SVGTextElement),'Couldn\'t find attached element to hook the CountUp instance into! Try to attach "containerRef" from the render prop to a an HTMLElement, eg. <span ref={containerRef} />.'),m(t.containerRef.current,t.props)})),l(p(p(t)),"pauseResume",(function(){var e=p(p(t)),n=e.reset,o=e.restart,r=e.update,a=t.props.onPauseResume;t.instance.pauseResume(),a({reset:n,start:o,update:r})})),l(p(p(t)),"reset",(function(){var e=p(p(t)),n=e.pauseResume,o=e.restart,r=e.update,a=t.props.onReset;t.instance.reset(),a({pauseResume:n,start:o,update:r})})),l(p(p(t)),"restart",(function(){t.reset(),t.start()})),l(p(p(t)),"start",(function(){var e=p(p(t)),n=e.pauseResume,o=e.reset,r=e.restart,a=e.update,i=t.props,s=i.delay,u=i.onEnd,c=i.onStart,l=function(){return t.instance.start((function(){return u({pauseResume:n,reset:o,start:r,update:a})}))};s>0?t.timeoutId=setTimeout(l,1e3*s):l(),c({pauseResume:n,reset:o,update:a})})),l(p(p(t)),"update",(function(e){var n=p(p(t)),o=n.pauseResume,r=n.reset,a=n.restart,i=t.props.onUpdate;t.instance.update(e),i({pauseResume:o,reset:r,start:a})})),l(p(p(t)),"containerRef",s.createRef()),t}var t,o,r;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&f(e,n)}(n,e),t=n,(o=[{key:"componentDidMount",value:function(){var e=this.props,n=e.children,t=e.delay;this.instance=this.createInstance(),"function"==typeof n&&0!==t||this.start()}},{key:"shouldComponentUpdate",value:function(e){return this.props.duration!==e.duration||this.props.end!==e.end||this.props.start!==e.start||this.props.redraw}},{key:"componentDidUpdate",value:function(e){this.props.duration===e.duration&&this.props.start===e.start||(this.instance=this.createInstance(),this.start()),this.props.end!==e.end&&(this.instance.reset(),this.instance.update(this.props.end))}},{key:"componentWillUnmount",value:function(){this.timeoutId&&clearTimeout(this.timeoutId),this.instance.reset()}},{key:"render",value:function(){var e=this.props,n=e.children,t=e.className,o=e.style,r=this.containerRef,a=this.pauseResume,i=this.reset,u=this.restart,c=this.update;return"function"==typeof n?n({countUpRef:r,pauseResume:a,reset:i,start:u,update:c}):s.createElement("span",{className:t,ref:r,style:o})}}])&&c(t.prototype,o),r&&c(t,r),n}(i.Component);l(g,"propTypes",{decimal:a.string,decimals:a.number,delay:a.number,easingFn:a.func,end:a.number.isRequired,formattingFn:a.func,onEnd:a.func,onStart:a.func,prefix:a.string,redraw:a.bool,separator:a.string,start:a.number,suffix:a.string,style:a.object,useEasing:a.bool}),l(g,"defaultProps",{decimal:".",decimals:0,delay:null,duration:null,easingFn:null,formattingFn:null,onEnd:function(){},onPauseResume:function(){},onReset:function(){},onStart:function(){},onUpdate:function(){},prefix:"",redraw:!1,separator:"",start:0,suffix:"",style:void 0,useEasing:!0});n.default=g,n.useCountUp=function(e){var n=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),o.forEach((function(n){l(e,n,t[n])}))}return e}({},g.defaultProps,e),t=n.start,o=n.formattingFn,r=h(i.useState("function"==typeof o?o(t):t),2),a=r[0],s=r[1],u=i.useRef(null),c=function(){var e=u.current;if(null!==e)return e;var t=function(){var e=m(-1,n),t=e.options.formattingFn;return e.options.formattingFn=function(){var e=t.apply(void 0,arguments);s(e)},e}();return u.current=t,t},d=function(){var e=n.onReset;c().reset(),e({pauseResume:p,start:f,update:k})},f=function e(){var t=n.onStart,o=n.onEnd;c().reset(),c().start((function(){o({pauseResume:p,reset:d,start:e,update:k})})),t({pauseResume:p,reset:d,update:k})},p=function(){var e=n.onPauseResume;c().pauseResume(),e({reset:d,start:f,update:k})},k=function(e){var t=n.onUpdate;c().update(e),t({pauseResume:p,reset:d,start:f})};return i.useEffect((function(){var e=n.delay,t=n.onStart,o=n.onEnd,r=setTimeout((function(){t({pauseResume:p,reset:d,update:k}),c().start((function(){clearTimeout(r),o({pauseResume:p,reset:d,start:f,update:k})}))}),1e3*e);return d}),[]),{countUp:a,start:f,pauseResume:p,reset:d,update:k}}},551:function(e,n,t){"use strict";var o=function(){};e.exports=o},593:function(e,n,t){"use strict";t.r(n),t.d(n,"TokenModalClass",(function(){return b})),t.d(n,"TokenModal",(function(){return v}));var o=t(357),r=t(360),a=t(552),i=t(662),s=t(772),u=t(363),c=t(663),l=t(410),d=t(3),f=t(6),p=t(15),h=t(0),m=t(75),g=t(76),k=t(7),b=function(){function e(){var e=this;this.handleResizeStop=this.handleResizeStop.bind(this),this.$tokenHeaderButton=$(".main-token-status-container"),this.initialStep=void 0,$(document).on("click",".main-token-status-container",(function(){e.$tokenHeaderButton.is(".selected")?e.render(!1):e.render(!0)})).on("click",".token-notifier-container .sign-in-button",(function(){return e.render(!1)})).on("slideMenuOpened modalOpening searchOpen",(function(){return e.render(!1)})).on("click",".token-ledger-table-container a",(function(){return e.render(!1)})).on("withinChapterLinkScroll",(function(){return e.render(!1)})).on("landing-page-appropriate-releases-initialized",(function(){void 0!==e.initialStep&&(e.render(!0),e.initialStep=void 0)})),$(window).on("resizestop",this.handleResizeStop),m.a.getTokenProductOffering().then((function(n){e.tokenProductOfferingPrice=n.price||.01})).catch((function(n){console.log("Error when getting token product offering price"),e.tokenProductOfferingPrice=.01}))}return e.prototype.initialize=function(){this.initialStep=this.getInitialTokenModalState()},e.prototype.getInitialTokenModalState=function(){var e=document.location.hash||document.location.pathname;return e.indexOf("token-ledger")>=0?s.a.ledger:e.indexOf("token-modal")>=0?s.a.showingTokenInfo:e.indexOf("token-cashout")>=0?s.a.cashout:e.indexOf("get-tokens")>=0?s.a.purchasing:void 0},e.prototype.clean=function(){r.unmountComponentAtNode(document.getElementById("full-screen-modal")),this.$tokenHeaderButton.removeClass("selected")},e.prototype.handleResizeStop=function(){var e=this;this.positionModal(),setTimeout((function(){return e.positionModal()}),100)},e.prototype.positionModal=function(){if($(document.body).is(".ReactModal__Body--open")){var e=$(".ReactModal__Overlay");if(!(e.find(".shopping-cart-modal").length>0)){var n=f.a.getNavbarHeightInPx();e.css("top",n)}}},e.prototype.show=function(){this.render(!0),this.positionModal()},e.prototype.hide=function(){this.render(!1)},e.prototype.render=function(e){var n=this;this.$tokenHeaderButton.toggleClass("selected",e),k.a.isCurrentlyLoggedIn()?r.render(o.createElement(s.b,{isShown:e,onClose:function(){return n.render(!1)},livebookBaseLink:h.a.getLivebookBaseUrl(),livevideoBaseLink:h.a.getLivevideoBaseUrl(),initialStep:this.initialStep,tokenPrice:this.tokenProductOfferingPrice||.01,topOffset:f.a.getNavbarHeightInPx(),onCashout:function(){return new Promise((function(e,n){l.a.cashout().then((function(t){t&&!1===t.success&&t.reason?n(t.reason):e(!0)})).catch((function(e){n("Error when performing cashout. Try later or contact our support: support@manning.com")}))}))},onAddTokensToCart:function(e){return n.buyTokens(e)},getCashoutPaymentTypes:function(){return new Promise((function(e,n){l.a.getTokenCashoutInfo().then((function(n){e(n&&n.paymentsInfo)})).catch((function(e){n("Error when ")}))}))},getTokenLedgerItems:function(){return l.a.getTokenLedgerItems()},getTokenState:function(){return new Promise((function(n,t){l.a.getTokenCountInfo(e).then((function(e){l.a.setTokenCountInfo(e),g.a.refreshTokenStateInToolbar(e),n(e)})).catch((function(e){t(e)}))}))}}),document.getElementById("full-screen-modal")):r.render(o.createElement(a.a,{isShown:e,title:"Tokens",onClose:function(){return n.render(!1)},topOffset:f.a.getNavbarHeightInPx()},o.createElement("p",null,"Tokens can be used to unlock parts of books, from sub-sections to chapters.",o.createElement("br",null),"Any dollar amount spent unlocking content will be deducted from the final book price.",o.createElement("br",null),"You can cash out any time, reverting tokens back to dollars."),o.createElement("p",null,o.createElement("a",{className:"sign-in-button micropurchase-sign-in",href:"javascript:void(0)"},"sign in")," and get 500 tokens for FREE!")),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfTokensNotifier=function(e,n){var t=this;void 0===n&&(n=!0),r.render(o.createElement(i.a,{isShown:n,topOffset:f.a.getNavbarHeightInPx(),showBuyTokensButton:!0,showCartButton:!0,isProductAlreadyInCart:m.a.isEbookInShoppingCart(e),productType:"book",productTitle:p.a.cleanBookTitle(e.title),isMeap:e.isMeap,onRequestBuyTokens:function(){t.renderOutOfTokensNotifier(e,!1),setTimeout((function(){t.initialStep=s.a.purchasing,t.render(!0)}),200)},onRequestCart:function(){m.a.isEbookInShoppingCart(e)||m.a.requestAddBookToCart(e),t.renderOutOfTokensNotifier(e,!1)},onClose:function(){return t.renderOutOfTokensNotifier(e,!1)}}),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfParagraphByParagraphUnlocks=function(e,n){var t=this;r.render(o.createElement(a.a,{isShown:e,title:"Out of individual paragraph tokens",onClose:function(){return t.renderOutOfParagraphByParagraphUnlocks(!1)},topOffset:f.a.getNavbarHeightInPx()},o.createElement("p",null,n)),document.getElementById("full-screen-modal"))},e.prototype.renderLicenceCreatedModal=function(e){var n=this;void 0===e&&(e=!0),r.render(o.createElement(a.a,{isShown:e,title:"you've spent enough tokens on this book to unlock the rest of it for free",theme:u.a.green,topOffset:f.a.getNavbarHeightInPx(),onClose:function(){return n.renderLicenceCreatedModal(!1)}},o.createElement("em",null,"the full eBook is in your ",o.createElement("a",{href:""+h.a.getMarketplaceUrl("dashboard"),style:{color:"white"}},"library")," for you to download or save at your leisure")),document.getElementById("full-screen-modal"))},e.prototype.renderUpsellModal=function(e,n,t,a){var i=this;void 0===e&&(e=!0),r.render(o.createElement(c.a,{isShown:e,spentTokenAmount:t,spentDollarAmount:a,productTitle:p.a.cleanBookTitle(n&&n.title),onBuy:function(){m.a.isEbookInShoppingCart(n)?m.a.requestMenuOpen():m.a.requestAddBookToCart(n)},topOffset:f.a.getNavbarHeightInPx(),onClose:function(){return i.renderUpsellModal(!1)}}),document.getElementById("full-screen-modal"))},e.prototype.buyTokens=function(e){m.a.addTokensToCart(e),d.a.setTimeout((function(){return m.a.requestMenuOpen()}),150)},e}(),v=new b}}]);
//# sourceMappingURL=unlockManager.chunk.js.map?e1252e401758326e0218