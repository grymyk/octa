(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{434:function(i,t,n){"use strict";n.d(t,"a",(function(){return a}));var s=n(22),e=n(0),o=n(7),r=$(document),a=new(function(){function i(){var i=this;$(document).on("appActivatedAfterLongTime",(function(){i.wishList=null,i.wishListPromise=null,i.isSyncing=!1}))}return i.prototype.hasInitializedWishList=function(){return null!=this.wishList},i.prototype.onSyncingChanged=function(i){this.syncingCallback=i},i.prototype.isBookInWishList=function(i){return null!=i&&this.isProductInWishList(i.manningId)},i.prototype.isProductInWishList=function(i){return null!=this.wishList&&null!=this.wishList.items&&0!=this.wishList.items.length&&null!=this.wishList.items.find((function(t){return null!=t.product&&t.product.id==i}))},i.prototype.updateSyncing=function(i){this.isSyncing!=i&&(this.isSyncing=i,this.syncingCallback&&this.syncingCallback())},i.prototype.addBookToWishList=function(i){return this.addProductToWishList(i.manningId)},i.prototype.addProductToWishList=function(i){var t=this;return new Promise((function(n,o){t.getUserWishList().then((function(a){if(!a.id)return o("User is not logged in");t.updateSyncing(!0),e.a.postToOurBackend(e.a.getAbsoluteUrl("api/wishList/"+a.id+"/addItem/"+i),(function(s){t.updateSyncing(!1),t.syncingCallback&&t.syncingCallback(),s?(t.wishList=s,n(s),t.wishListPromise=Promise.resolve(t.wishList),r.trigger("wishListArrived",s),r.trigger("wishListAdd",[i,!0])):o("Not enough information")}),(function(i){t.updateSyncing(!1),o(),s.a.getUserEmail().then((function(i){r.trigger("wishListFail",[i+"-"+(new Date).getTime(),"N/A","N/A"])})).catch((function(i){r.trigger("wishListFail",["unknownUser-"+(new Date).getTime(),"N/A","N/A"])}))}),{},!0,!0,!1,!1)})).catch((function(i){return o(i)}))}))},i.prototype.removeProductFromWishList=function(i){var t=this;return new Promise((function(n,o){t.getUserWishList().then((function(a){var h=a.items.find((function(t){return t.product.id==i}));if(!h)return o("wish list item not found");t.updateSyncing(!0),e.a.interactWithOurBackend(e.a.getAbsoluteUrl("api/wishList/removeItem/"+h.id),"delete",(function(s){if(t.updateSyncing(!1),!s)return r.trigger("wishListFail",["unknownUser-"+(new Date).getTime(),"N/A","N/A"]),void o("Not enough information");t.wishList=s,n(s),t.wishListPromise=Promise.resolve(t.wishList),r.trigger("wishListArrived",s),r.trigger("wishListRemove",[i])}),(function(i){t.updateSyncing(!1),s.a.getUserEmail().then((function(i){r.trigger("wishListFail",[i+"-"+(new Date).getTime(),"N/A","N/A"])})).catch((function(i){r.trigger("wishListFail",["unknownUser-"+(new Date).getTime(),"N/A","N/A"])}))}),{},!0,!0,!1,!1)})).catch((function(i){return o(i)}))}))},i.prototype.getUserWishList=function(){var i=this;return o.a.isCurrentlyLoggedIn()?null!=this.wishListPromise?this.wishListPromise:this.wishListPromise=new Promise((function(t,n){i.updateSyncing(!0),e.a.getFromOurBackend(e.a.getAbsoluteUrl("wishList"),(function(s){if(i.updateSyncing(!1),!s)return r.trigger("wishListFail",["unknownUser-"+(new Date).getTime(),"N/A","N/A"]),void n("Not enough information");i.wishList=s,t(s),i.wishListPromise=Promise.resolve(i.wishList),r.trigger("wishListArrived",s)}),(function(t){i.wishListPromise=null,i.updateSyncing(!1),s.a.getUserEmail().then((function(i){r.trigger("wishListFail",[i+"-"+(new Date).getTime(),"N/A","N/A"])})).catch((function(i){r.trigger("wishListFail",["unknownUser-"+(new Date).getTime(),"N/A","N/A"])}))}),{},!0,!0,!1,!1)})):Promise.resolve({id:-1,title:"",items:[]})},i}())},767:function(i,t,n){"use strict";n.r(t),n.d(t,"WishListManager",(function(){return h}));var s=n(434),e=n(29),o=n(9),r=n(3),a=n(7),h=new(function(){function i(){this.handleMainWishListIconClick=this.handleMainWishListIconClick.bind(this),this.handleWishListRemove=this.handleWishListRemove.bind(this),this.$mainWishListIcons=$("#footer .wish-list-icon, #top-bar-container .wish-list-icon"),r.a.onEventWithCooldown(this.$mainWishListIcons,"click",this.handleMainWishListIconClick),$(document).on("wishListRemove",this.handleWishListRemove)}return i.prototype.initalize=function(i){var t=this;this.book=i,a.a.isLoggedIn().then((function(i){i.loggedIn&&s.a.getUserWishList().then((function(i){null!=t.$mainWishListIcons&&t.toggleHeartIcons(t.isCurrentBookInWishList(i))}))}))},i.prototype.clean=function(){this.book=null,null!=this.$mainWishListIcons&&this.$mainWishListIcons.toggleClass("active",!1).toggleClass("fa-heart-o",!0).toggleClass("fa-heart",!1)},i.prototype.addCurrentBookToWishList=function(){var i=this;this.book&&s.a.getUserWishList().then((function(t){i.isCurrentBookInWishList(t)||s.a.addBookToWishList(i.book).then((function(){i.toggleHeartIcons(!0),i.$mainWishListIcons.removeClass("pulse"),o.a.visuallyShowHearting()})).catch((function(t){i.$mainWishListIcons.removeClass("pulse")}))}))},i.prototype.handleMainWishListIconClick=function(i){var t=this;a.a.isCurrentlyLoggedIn()?s.a.isSyncing||(this.$mainWishListIcons.addClass("pulse"),s.a.getUserWishList().then((function(i){t.isCurrentBookInWishList(i)?s.a.removeProductFromWishList(t.book.manningId).then((function(){t.toggleHeartIcons(!1),t.$mainWishListIcons.removeClass("pulse")})).catch((function(i){t.$mainWishListIcons.removeClass("pulse")})):s.a.addBookToWishList(t.book).then((function(){t.toggleHeartIcons(!0),t.$mainWishListIcons.removeClass("pulse"),o.a.visuallyShowHearting()})).catch((function(i){t.$mainWishListIcons.removeClass("pulse")}))})).catch((function(i){t.$mainWishListIcons.removeClass("pulse"),$(document).trigger("requestNotification","Error syncing wish list")}))):e.a.requestLogin("sign in to add a book to your wishlist","wishlist")},i.prototype.toggleHeartIcons=function(i){this.$mainWishListIcons.toggleClass("active",i).toggleClass("fa-heart-o",!i).toggleClass("fa-heart",i),this.$mainWishListIcons.each((function(t,n){var s=window.Foundation.libs.tooltip.getTip($(n));s&&s.length&&s.text(i?"remove from wish list":"add to wish list")}))},i.prototype.isCurrentBookInWishList=function(i){var t=this;return!!(this.book&&i&&i.items&&i.items.length)&&null!=i.items.find((function(i){return i.product.id==t.book.manningId}))},i.prototype.handleWishListRemove=function(i,t,n){n||null!=this.book&&this.book.manningId==t&&this.toggleHeartIcons(!1)},i}())}}]);
//# sourceMappingURL=wishListManager.chunk.js.map?7b0afd5c16f5af6a1a03